---
title: "Micro informe: resultados encuestas MOVID-IMPACT por temáticas de interés"
author: "Renzo Peragallo Díaz"
date: "2023-05-22"
output:
  pdf_document:
    toc: true
    toc_depth: 3
    latex_engine: pdflatex
header-includes:
- \usepackage{multicol}
- \usepackage{geometry}
- \geometry{left=1in,right=1in,top=1in,bottom=1in}
always_allow_html: true
---

<style type="text/css">
  body{
  font-size: 14pt;
}
</style>

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r librerias_funciones, include=FALSE}
# ++ Librerias ---------------------------------------------------------------

if (!require(pacman)){install.packages("pacman")}
library(pacman)
p_load(tidyverse,
       funModeling, # Estadisticas descriptivas
       haven, # Lectura dta
       janitor,# Funciones adicionales
       survey, # Análisis muestral
       srvyr, # Paquete survey en lenguaje dplyr
       purrr, # Funcion map
       ggthemes, #Temas gráficos
       kableExtra, # Tablas html para markdown
       extrafont)  # Para utilizar fuentes del sistema en ggplot



# ++ Funciones ---------------------------------------------------------------




# Razones no vacunacion ---------------------------------------------------


# Funcion especifica que sirve para obtener tabulados con las razones de no vacunación 
calculo_razones_no_vacunacion <- function(srvyr_object, variable) {
  variable <- rlang::sym(variable) # Permite que el elemento del vector pueda ser evaluado por la funcion. 
  df <- srvyr_object %>%
    filter(!is.na(!!variable)) %>%
    group_by(!!variable) %>%
    summarize(proportion = survey_mean(vartype = "ci"))
  return(df)
}


# Grafico bivariado -------------------------------------------------------

# Funcion que toma una salida bivariada de svyr y la transforma en un gráfico
graph_barras_bivariado <- function(df_original, 
                                   titulo, 
                                   label_eje_x = NULL, 
                                   subtitulo = NULL, 
                                   angulo_text_eje_x = 0,
                                   hjust_text_eje_x = 0.5,
                                   ancho_texto_x = NULL){
  # EXPLICACION GENERAL 
  # SE CREARON TRES ARGUMENTOS PARA PODER PERSONALIZAR LA POSICIÓN DE LAS ETIQUETAS EN EL EJE X: 
  # angulo_text_eje_x = 45  pone el texto en 45 grados ( o cualquier angulo deseado),
  # hjust_text_eje_x = 0.8 alinea el texto cuando se gira. Se recomienda utilizar en 0.8 si el texto está en 45, si está en 0 grados, poner en 0.5. 
  # ancho_texto_x = 10 Limita el número de caracteres de la  etiqueta del eje X. Se usa para incluir saltos de linea
  #  cuando las etiquetas no caben bien. 
  df <- df_original 

  # Preparando los datos para poder referirme a ellos en ggplot y transformandolos a porcentaje
  df$x <- as.factor(df[[1]])
  
  if (!is.null(ancho_texto_x)){
    df$x <- str_wrap(df$x, width = ancho_texto_x)
  }
  
  
  df$y <- round(df[[3]] * 100, 1)
  df$group_fill <- as.factor(df[[2]])
  df$ymax <- round(df[[5]] * 100, 1) 
  df$ymin <- round(df[[4]] * 100, 1)
  # Gráfico
  mi_grafico <- ggplot(data = df, 
         aes(x = x, 
             y = y, 
             group = group_fill, 
             fill = group_fill,
             ymax = ymax, 
             ymin = ymin)) +
    geom_col(stat = "identity", position = "dodge") + # identity permite trabajar con los datos agregados
    geom_errorbar(position = position_dodge(width = 0.9), width = 0.1) + # se añaden barras de error
    labs(title = titulo, # Titulo gráfico
         subtitle = if (is.null(subtitulo)){""} else {subtitulo}, # No se aplica por el tema del gráfico
         x = if (is.null(label_eje_x)){""} else {label_eje_x},  # Titulo eje x (con este tema no se usa así que lo dejé en nulo)
         y = "%") + # titulo eje y (no se visualiza en este tema)
    ylim(0,100) + # limites eje y 
    geom_text(aes(y = ymax, label = y), 
              position = position_dodge(width = 0.9), 
              vjust = -1,
              size = 3,
              fontface = 2) + # Argumento que agrega cursivas, negritas, etc
    scale_fill_discrete(name = "") + # Titulo leyenda 
    theme_minimal() +
    theme(
      legend.position = "bottom", # Posicion leyenda
      plot.title = element_text(size = rel(1.2), face = "bold", hjust = 0.5), # Ajusta el tamaño, tipo de letra y alineación del título del gráfico
      plot.subtitle = element_text(hjust = 0.5, size = rel(1)), # Subtítulo centrado
      legend.title = element_text(size = rel(1), face = "bold"), # Ajusta el tamaño y tipo de letra del título de la leyenda
      legend.text = element_text(size = rel(0.8)), # Ajusta el tamaño de la leyenda
      axis.title = element_text(size = rel(1), face = "bold"), # Ajusta el tamaño y tipo de letra de los títulos de los ejes
      axis.text = element_text(size = rel(0.8)),
      axis.text.x = element_text(angle = angulo_text_eje_x, hjust = hjust_text_eje_x))  # Rota las etiquetas del eje x 45 grados) # Ajusta el tamaño del texto de los ejes
  return(mi_grafico)
}

# Prueba de la funcion
# graph_barras_bivariado(df_prueba,
#                        titulo = "Importancia pase de movilidad para vacunacion (d12.9) por tramo etario")
# graph_barras_bivariado(acata_normas_comparacion_anos,
#                        titulo = "Acata normas, comparacion año 2020 y 2022.",
#                        subtitulo = "prueba",
#                        angulo_text_eje_x = 0,
#                        hjust_text_eje_x = 0.5,
#                        ancho_texto_x = NULL)



# Grafico univariado ------------------------------------------------------

# Funcion que toma una salida univariada de svyr y la transforma en un gráfico
graph_barras_univariado <- function(df_original, 
                                    titulo, 
                                    label_eje_x = NULL, 
                                    subtitulo = NULL, 
                                    angulo_text_eje_x = 0,
                                    hjust_text_eje_x = 0.5,
                                    ancho_texto_x = NULL){
  # EXPLICACION GENERAL 
  # SE CREARON TRES ARGUMENTOS PARA PODER PERSONALIZAR LA POSICIÓN DE LAS ETIQUETAS EN EL EJE X: 
  # angulo_text_eje_x = 45  pone el texto en 45 grados ( o cualquier angulo deseado),
  # hjust_text_eje_x = 0.8 alinea el texto cuando se gira. Se recomienda utilizar en 0.8 si el texto está en 45, si está en 0 grados, poner en 0.5. 
  # ancho_texto_x = 10 Limita el número de caracteres de la  etiqueta del eje X. Se usa para incluir saltos de linea
  #  cuando las etiquetas no caben bien. 
  
  df <- df_original 
  # Preparando los datos para poder referirme a ellos en ggplot y transformandolos a porcentaje
  df$x <- df[[1]]
  
  if (!is.null(ancho_texto_x)){
    df$x <- str_wrap(df$x, width = ancho_texto_x)
  }
  
  df$y <- round(df[[2]] * 100, 1)
  df$ymax <- round(df[[4]] * 100, 1) 
  df$ymin <- round(df[[3]] * 100, 1)
  # Gráfico
  mi_grafico <- ggplot(data = df, 
                       aes(x = x, 
                           y = y, 
                           fill = x, # Se dejó el argumento fill para que las barras conserven la paleta de colores
                           ymax = ymax, 
                           ymin = ymin)) +
    geom_col(stat = "identity", position = "dodge") + # identity permite trabajar con los datos agregados
    geom_errorbar(position = position_dodge(width = 0.9), width = 0.1) + # se añaden barras de error
    labs(title = titulo, # Titulo gráfico
         subtitle = if (is.null(subtitulo)){""} else {subtitulo}, # No se aplica por el tema del gráfico
         x = if (is.null(label_eje_x)){""} else {label_eje_x},  # Titulo eje x (con este tema no se usa así que lo dejé en nulo)
         y = "%") + # titulo eje y (no se visualiza en este tema)
    ylim(0,100) + # limites eje y 
    geom_text(aes(y = ymax, label = y), 
              position = position_dodge(width = 0.9), 
              vjust = -1,
              size = 3,
              fontface = 2) + # Argumento que agrega cursivas, negritas, etc
    scale_fill_discrete(name = "") + # Titulo leyenda (no se usa en este tema)
    theme_minimal() +
    theme(
      legend.position = "none", # Posicion leyenda
      plot.title = element_text(size = rel(1.2), face = "bold", hjust = 0.5), # Ajusta el tamaño, tipo de letra y alineación del título del gráfico
      plot.subtitle = element_text(hjust = 0.5, size = rel(1)), # Subtítulo centrado
      legend.title = element_text(size = rel(1), face = "bold"), # Ajusta el tamaño y tipo de letra del título de la leyenda
      legend.text = element_text(size = rel(0.8)), # Ajusta el tamaño de la leyenda
      axis.title = element_text(size = rel(1), face = "bold"), # Ajusta el tamaño y tipo de letra de los títulos de los ejes
      axis.text = element_text(size = rel(0.8)),
      axis.text.x = element_text(angle = angulo_text_eje_x, hjust = hjust_text_eje_x)) # Ajusta el tamaño del texto de los ejes
  return(mi_grafico)
}

# Prueba de la funcion
# df_prueba_2 <- movid_2022_s |>
#   filter(!d12_9_recoded == "NS/NR") |>
#   group_by(d12_9_recoded) |>
#   summarize(proportion = survey_mean(vartype = "ci"))
# 
# 
# graph_barras_univariado(df_prueba_2,
#                         titulo = "Importancia pase de movilidad para vacunacion (d12.9) por tramo etario",
#                         subtitulo = "prueba",
#                         angulo_text_eje_x = 45,
#                         hjust_text_eje_x = 0.8)


# Ejemplo (ejecutar script 2 3 y 4 primero)
# razon_pospuso_tratamiento <- 
#   movid_2020_s |> 
#   filter(cronica_d == 1, pospuso_tratamiento == "Pospuso tratamiento") |> 
#   group_by(razon_pospuso_tratamiento) |> 
#   summarize(proportion = survey_mean(vartype = "ci")) |> 
#   mutate(razon_pospuso_tratamiento = recode(as.factor(razon_pospuso_tratamiento),
#                                             '1' = "Porque no le pareció importante controlarse",
#                                             '2' = "Por el costo económico",
#                                             '4' = "Porque tenía que esperar mucho tiempo",
#                                             '5' = "Por miedo a contagiarse de COVID-19",
#                                             '6' = "Porque el sistema de salud está muy lleno",
#                                             '7' = "No contó con trasporte para trasladarse al lugar de atención",
#                                             '8' = "No tuvo con quien dejar a personas a su cuidado",
#                                             '9' = "El consultorio, hospital o clínica le suspendió la hora y no le ha reagendado",
#                                             '10' = "Otro",
#                                             '98' = "No sabe"))
# graph_barras_univariado(razon_pospuso_tratamiento,
#                         titulo = "Razón por la que se pospuso el tratamiento",
#                         angulo_text_eje_x = 0,
#                         hjust_text_eje_x = 0.5,
#                         ancho_texto_x = 10)


# Moda --------------------------------------------------------------------

# Función moda (se utiliza para imputacion en indice de salud mental)

moda <- function(x) {
  tabla <- table(x)
  modas <- as.numeric(names(tabla)[tabla == max(tabla)])
  return(modas)
}


# Sin usar ----------------------------------------------------------------

proporcion_grupo <- 
  function(srvyr_object, variable_agrupada){
    df <- {{srvyr_object}} |> 
      group_by({{variable_agrupada}}) |> 
      summarize(proportion = survey_mean(vartype = "ci"),
                total = survey_total(vartype = "ci"))
    return(df)
    print(df)
  }



# Funciones depreciadas (tema excel para gráficos) ------------------------

# 
# # Funcion que toma una salida bivariada de svyr y la transforma en un gráfico
# graph_barras_bivariado <- function(df_original, titulo, label_eje_x = NULL, subtitulo = NULL){
#   df <- df_original 
#   # Preparando los datos para poder referirme a ellos en ggplot y transformandolos a porcentaje
#   df$x <- as.factor(df[[1]])
#   df$y <- round(df[[3]] * 100, 1)
#   df$group_fill <- as.factor(df[[2]])
#   df$ymax <- round(df[[5]] * 100, 1) 
#   df$ymin <- round(df[[4]] * 100, 1)
#   # Gráfico
#   mi_grafico <- ggplot(data = df, 
#                        aes(x = x, 
#                            y = y, 
#                            group = group_fill, 
#                            fill = group_fill,
#                            ymax = ymax, 
#                            ymin = ymin)) +
#     geom_col(stat = "identity", position = "dodge") + # identity permite trabajar con los datos agregados
#     geom_errorbar(position = position_dodge(width = 0.9), width = 0.1) + # se añaden barras de error
#     labs(title = titulo, # Titulo gráfico
#          subtitle = if (is.null(subtitulo)){""} else {subtitulo}, # No se aplica por el tema del gráfico
#          x = if (is.null(label_eje_x)){""} else {label_eje_x},  # Titulo eje x (con este tema no se usa así que lo dejé en nulo)
#          y = "%") + # titulo eje y (no se visualiza en este tema)
#     ylim(0,100) + # limites eje y 
#     geom_text(aes(y = ymax, label = y), 
#               position = position_dodge(width = 0.9), 
#               vjust = -1,
#               size = 3,
#               fontface = 2) + # Argumento que agrega cursivas, negritas, etc
#     scale_fill_discrete(name = "Leyenda") + # Titulo leyenda (no se usa en este tema)
#     theme(legend.position = "bottom") +  # Posicion leyenda
#     theme_excel_new() + # tema excel 
#     scale_fill_excel_new(theme = "Badge") # paleta de colores para el tema excel
#   return(mi_grafico)
# }
# 
# # Prueba de la funcion
# # graph_barras_bivariado(df_prueba,
# #                        titulo = "Importancia pase de movilidad para vacunacion (d12.9) por tramo etario")
# # graph_barras_bivariado(acata_normas_comparacion_anos,
# #                        titulo = "Acata normas, comparacion año 2020 y 2022.",
# #                        subtitulo = "prueba")
# 
# 
# # Funcion que toma una salida univariada de svyr y la transforma en un gráfico
# graph_barras_univariado <- function(df_original, titulo, label_eje_x = NULL){
#   df <- df_original 
#   # Preparando los datos para poder referirme a ellos en ggplot y transformandolos a porcentaje
#   df$x <- df[[1]]
#   df$y <- round(df[[2]] * 100, 1)
#   df$ymax <- round(df[[4]] * 100, 1) 
#   df$ymin <- round(df[[3]] * 100, 1)
#   # Gráfico
#   mi_grafico <- ggplot(data = df, 
#                        aes(x = x, 
#                            y = y, 
#                            fill = x, # Se dejó el argumento fill para que las barras conserven la paleta de colores
#                            ymax = ymax, 
#                            ymin = ymin)) +
#     geom_col(stat = "identity", position = "dodge") + # identity permite trabajar con los datos agregados
#     geom_errorbar(position = position_dodge(width = 0.9), width = 0.1) + # se añaden barras de error
#     ylim(0,100) + # limites eje y 
#     geom_text(aes(y = ymax, label = y), 
#               position = position_dodge(width = 0.9), 
#               vjust = -1,
#               size = 3,
#               fontface = 2) + # Argumento que agrega cursivas, negritas, etc
#     scale_fill_discrete(name = "Leyenda") + # Titulo leyenda (no se usa en este tema)
#     theme_excel_new() + # tema excel 
#     scale_fill_excel_new(theme = "Badge") + # paleta de colores para el tema excel
#     theme(legend.position = "none") # Posicion leyenda. Se pone none porque es univariado pero se quiere mantener los colores
#   return(mi_grafico)
# }
# 
# # Prueba de la funcion
# # df_prueba_2 <- movid_2022_s |> 
# #   filter(!d12_9_recoded == "NS/NR") |> 
# #   group_by(d12_9_recoded) |> 
# #   summarize(proportion = survey_mean(vartype = "ci"))
# # graph_barras_univariado(df_prueba_2, titulo = "Importancia pase de movilidad para vacunacion (d12.9) por tramo etario")



```


```{r preparacion_bbdd_2022, include=FALSE}
#  ++ Lectura BBDD ------------------------------------------------------------

## Lectura bases 

movid_2022 <- read_dta("./input/2022/MOVID-IMPACT-2022.dta")

## Limpieza nombres columnas 

movid_2022 <- janitor::clean_names(movid_2022)

## Selecciona a las personas efectivamente entrevistadas de la bbdd

movid_2022 <- movid_2022 %>% filter(entrevistado == 1) # Seleccionar a los entrevistados.




# ++ Variables independientes ------------------------------------------------


# Sexo --------------------------------------------------------------------

# 1 hombre, 2 mujer
movid_2022 |> group_by(sexo) |> tally()


# Nivel educacional -------------------------------------------------------

# Opcion 1
movid_2022 <- movid_2022 %>% 
  mutate(educ_2 = as.factor(case_when(
    a7 == 1 | a7 == 2 ~ "Nunca asistió",
    a7 == 3 | a7 == 4 ~ "Básica",
    a7 == 5 | a7 == 6 ~ "Media",
    a7 == 7 | a7 == 8 ~ "Superior",
    a7 == 9 ~ "Postgrado")))

# Opcion 2: Se recomienda usar esta por IC
movid_2022 <- movid_2022 %>% 
  mutate(educ_3 = as.factor(case_when(
    a7 == 1 | a7 == 2 | a7 ==  3 |a7 == 4 ~ "Básica o nunca asistió",
    a7 == 5 | a7 ==6 ~ "Media",
    a7 == 7 | a7 ==8 | a7 == 9 ~ "Superior o postgrado")))


# Prevision de salud ------------------------------------------------------

movid_2022 <- 
  movid_2022 %>% 
  mutate(prevision = as.factor(
    case_when(
      a11 == 1 ~ "Fonasa",
      a11 == 2 ~ "Isapre",
      a11 == 5 ~ "Ninguna", 
      a11 == 3 | a11 == 4 ~ "Otra",
      a11 == 8 | a11 == 9 ~ "NS/NR")))

movid_2022 |> group_by(prevision) |> tally()


# Vacunacion --------------------------------------------------------------

# Personas con esquema inicial de vacunación completo
# 1 = Si, 2 = No. 
movid_2022 <- movid_2022 %>% 
  mutate(vacunacion = as.factor(case_when(
    (d1 == 1 & (d2 >= 2 | d3 == 5)) ~ "Esquema vacunacion inicial completo",
    (d1 == 2 | ((d3 == 1 | d3 == 2 | d3== 3 | d3 == 4) & d2 < 2 )) ~ "Sin esquema vacunacion inicial completo",
    TRUE ~ "Sin esquema vacunacion inicial completo"
  )))


levels(movid_2022$vacunacion)
movid_2022 |>  filter(vacunacion == 1) |> group_by(vacunacion) |> tally()
# Ocupados ----------------------------------------------------------------

movid_2022 <- 
  movid_2022 %>% 
  mutate(
     ocupacion_d = as.factor(case_when(
      g1 == 1 | g2 == 1 | g3 != 10 ~ "ocupados",
      g4 == 2  ~ "desocupados",
      TRUE ~ "fuera_fuerza_trabajo")))


# Tramo etario ------------------------------------------------------------

# Opcion 1: Desagregacion completa
movid_2022$edad_rec <- cut(movid_2022$edad,
                           include.lowest = TRUE,
                           right = TRUE,
                           breaks = c(18, 24, 34, 44, 54, 64, 80, Inf)
)

movid_2022 |> group_by(edad_rec) |> tally()

# Opcion 2: Desagregacion reducida (recomendable por IC)
movid_2022 <- movid_2022 %>% 
  mutate(edad_2 = as.factor(case_when(
    edad < 30 ~ "18 a 29 años",
    edad >= 30 & edad < 60 ~ "30 a 59 años",
    edad >= 60 ~ "60 años o más"
  )))


# Nivel de ingresos -------------------------------------------------------

# Se pregunta por ingresos del hogar, pero no se sabe de cuantas personas es el hogar, por lo tanto
# No se puede obtener ingreso percapita. 
# Por lo tanto, no se recomienda usar esta variable para análisis. 

# G8 responde nivel de ingresos continuo del hogar ? si/no
movid_2022 |> group_by(g8) |> tally()

# G8 monto ingresos continuo
movid_2022 |> group_by(g8_monto) |> tally()

# G9 Tramo ingresos
movid_2022 |> group_by(g9) |> tally()

# Conversion de tramos de ingresos a media de ingresos (variable continua)
movid_2022 <- 
  movid_2022 |> 
  mutate(tramo_ingresos_continuo = case_when(
    g9 == 1 ~ 100000,
    g9 == 2 ~ 275000,
    g9 == 3 ~ 425000,
    g9 == 4 ~ 650000,
    g9 == 5 ~ 1000000,
    g9 == 6 ~ 1600000,
    g9 == 7 ~ 3500000,
    g9 == 8 ~ 6000000
  ))

# Ingreso hogar total (con estimacion de ingresos continuos)
movid_2022 <- 
  movid_2022 |> 
  mutate(ingreso_hogar_completo = ifelse(g8 == 1, g8_monto, tramo_ingresos_continuo))

# Ingresos hogar por tramo de ingreso 

movid_2022$tramo_ingresos_hogar_completo <- cut(movid_2022$ingreso_hogar_completo,
                           include.lowest = TRUE,
                           right = TRUE,
                           ordered_result = TRUE,
                           labels = levels(haven::as_factor(movid_2022$g9))[1:8],
                           breaks = c(0,
                                      200000, 
                                      350000, 
                                      500000, 
                                      800000, 
                                      1200000, 
                                      2000000, 
                                      5000000,
                                      Inf))

# Se agrega categoria NS/NR a la clasificacion anterior
movid_2022 <- 
  movid_2022 |> 
  mutate(tramo_ingresos_hogar_completo = ifelse(is.na(tramo_ingresos_hogar_completo), 
                                                "NS/NR", 
                                                as.character(tramo_ingresos_hogar_completo)))
# Se transforma en factor
movid_2022$tramo_ingresos_hogar_completo <- 
  factor(movid_2022$tramo_ingresos_hogar_completo, 
         levels = c(levels(haven::as_factor(movid_2022$g9))[1:8], "NS/NR"))

# Variable final con el tramo de ingresos del hogar completo (visualizacion)
movid_2022 |> group_by(tramo_ingresos_hogar_completo) |>  tally()


# Enfermedad cronica ------------------------------------------------------

# IMPORTANTE: La pregunta de enfermedad crónica en año 2020 (c1) y 2022 (b2) difiere entre cuestionarios. 
# Se consideraron condiciones de salud mental como enfermedad crónica. 

# Personas con enfermedad cronica. 1 = 1  o más enfermedad cronicas / 0 = Sin enfermedad crónica. 
movid_2022 <- 
  movid_2022 %>% 
  mutate(cronica_d = ifelse(b2_a == 1 | b2_b == 1 | b2_c == 1  | b2_d == 1 |
                            b2_e == 1 | b2_f == 1 | b2_g == 1  | b2_h == 1 |
                            b2_i == 1 | b2_j == 1 | b2_k == 1  | b2_i == 1, 1, 0))

movid_2022 |> group_by(cronica_d) |> tally()
# Region ------------------------------------------------------------------

# # Ordenando region (no funciona)
# movid_2022$region <- 
#   ordered(movid_2022$region, 
#           levels = c(15, 1, 2, 3, 4, 5 ,6 ,7, 16, 8 , 9, 14, 10, 11, 12, 13), 
#           labels=c("Región de Arica y Parinacota", "Región de Tarapacá", "Región de Antofagasta", 
#                    "Región de Atacama", "Región de Coquimbo","Región de Valparaíso", "Región de O'Higgins",                     
#                    "Región del Maule", "Región de Ñuble", "Región del Bío Bío", "Región de la Araucanía",                  
#                    "Región de los Ríos", "Región de los Lagos", "Región de Aysén",  "Región de Magallanes y Antártica Chilena",
#                    "Región Metropolitana de Santiago"))          

movid_2022 %>% group_by(region) %>% tally()

# Región Poblacion
movid_2022 <- movid_2022 %>% mutate(region_d = as.factor(ifelse(region == 13, "RM", "Otra region")))
movid_2022 %>% group_by(region_d) %>% tally()


# Medios de información ---------------------------------------------------

## Transformar d11  y desagregaciones a dummy de 0 y 1. 
movid_2022 <- 
  movid_2022 |> 
  mutate(across(starts_with("d11"), ~ifelse(is.na(.), 0, 1), .names = "{.col}_d"))

## Nuevas variables dummies para reconocer medios de informacion

# Medios tradicionales: 1. Radio, 2. Television abierta, 3. diarios impresos o digitales. 
# RRSS: 4. Redes sociales
# Sitios noticias de internet: 5. Sitios noticias de internet
# Otras paginas web: 6. Otras paginas web
# Otro : 7. Otro
# NS/NR: 8. No sabe, 9. No responde

movid_2022 <- 
  movid_2022 |> 
  mutate(mi_tradicionales = as.factor(ifelse(d11_1_d == 1 | d11_2_d == 1 | d11_3_d == 1, 1, 0)),
         mi_rss = as.factor(ifelse(d11_4_d == 1, 1, 0)),
         mi_web_noticias = as.factor(ifelse(d11_5_d == 1, 1, 0)),
         mi_web_otras = as.factor(ifelse(d11_6_d == 1, 1, 0)),
         mi_otras = as.factor(ifelse(d11_7_d == 1, 1, 0))) 

## Se crea variable que revisa si la persona se informa por medios tradicionales, por internet, o ambos

# Medios tradicionales: 1. Radio, 2. Television abierta, 3. diarios impresos o digitales. 
# Internet:  4. Redes sociales, 5. Sitios noticias de internet, 6. Otras paginas web
# Ambos: Medios tradicionales e internet
# Otro/NS/NR : 7. Otro, 8. No sabe, 9. No responde

movid_2022 <- 
  movid_2022 |> 
  mutate(mi_web_o_tradicionales = as.factor(case_when(
    mi_tradicionales == 1 & (mi_rss == 1 | mi_web_noticias == 1 | mi_web_otras == 1) ~ "Ambos",
    mi_tradicionales == 1 ~ "Tradicionales",
    mi_rss == 1 | mi_web_noticias == 1 | mi_web_otras == 1 ~ "Internet",
    TRUE ~ "Otros/NS/NR")))


#  ++ Creación variables dependientes ----------------------------------------


# Antivacunas -------------------------------------------------------------

## d8.h Personas que estan en contra las vacunas en general. 

# Recordar que esta pregunta solo se hizo a personas que no tienen su esquema de vacunación completo 
# y  que  es poco o nada probable que se vacunen en las próximas dos semanas (79 personas en toda la muestra)

movid_2022 |> group_by(d8_h) |> tally()

# Ahora bien, se puede identificar a este grupo de "anti-vacunas" como aquellos que
# 1. no se han vacunado contra el coronavirus y 2. manifestan estar en contra de las vacunas en general. 
# IMPORTANTE : SOLO 13 PERSONAS EN LA MUESTRA. 

movid_2022 |> filter(d8_h == 1) |> group_by(d8_h) |> tally()

# Si bien no será un grupo  representantivo estadisticamente, se puede construir la variable "antivacunas"

movid_2022 <- 
  movid_2022 |> 
  mutate(antivacunas = case_when(d8_h == 1  ~ "Antivacunas",
                                 TRUE ~ "Acepta vacunas"))
movid_2022 |> group_by(antivacunas) |> tally()

# D12  Opinion vacunacion -------------------------------------------------

# Se recodifica para disminuir los IC.
movid_2022 <- 
  movid_2022 |> 
  mutate(across(starts_with("d12_"), 
                ~case_when(. %in% c(1:2) ~ "De acuerdo o muy de acuerdo",
                           . %in% c(3) ~ "Indiferente",
                           . %in% c(4:5) ~ "En desacuerdo o muy en desacuerdo",
                           . %in% c(8:9) ~ "NS/NR"),
                .names = "{.col}_recoded"))

# Comprobacion
movid_2022 |> select(starts_with("d12_") & ends_with("recoded"))


# E1: Modulo social -----------------------------------------------------------

movid_2022 <- 
  movid_2022 |> 
  mutate(across(starts_with("e1_"), 
                ~case_when(. %in% c(1:2) ~ "De acuerdo o muy de acuerdo",
                           . %in% c(3) ~ "Indiferente",
                           . %in% c(4:5) ~ "En desacuerdo o muy en desacuerdo",
                           . %in% c(8:9) ~ "NS/NR"),
                .names = "{.col}_recoded"))

# Comprobacion
movid_2022 |> select(starts_with("e1_") & ends_with("recoded"))


# Disposición vacunación anual --------------------------------------------

movid_2022 <- 
  movid_2022 |> 
  mutate(d13_recoded = case_when(d13 %in% c(1:2) ~ "Muy o bastante dispuesto",
                                 d13 %in% c(3) ~ "Algo dispuesto",
                                 d13 %in% c(4:5) ~ "Poco o nada dispuesto",
                                 d13 %in% c(8:9) ~ "NS/NR"))
movid_2022 |> group_by(d13_recoded) |> tally()


# D14 Opinion vacunación en niños -----------------------------------------

# Se recodifica para disminuir los IC.
movid_2022 <- 
  movid_2022 |> 
  mutate(d14_recoded = case_when(d14 %in% c(1:2) ~ "De acuerdo o muy de acuerdo",
                                 d14 %in% c(3) ~ "Indiferente",
                                 d14 %in% c(4:5) ~ "En desacuerdo o muy en desacuerdo",
                                 d14 %in% c(8:9) ~ "NS/NR"))
movid_2022 |> group_by(d14_recoded) |> tally()



# C7 respuesta a contacto estrecho sin sintomas  ----------------------------------------


# Posibles respuestas (se recodifican para poder ser sumadas)
# *Tuve que usar NA como referencia para que funcionara el ifelse

movid_2022 <- 
  movid_2022 |> 
  mutate(c7_1 = if_else(is.na(c7_1), 0, 1), # No haría nada c7_1 == 1
         c7_2 = if_else(is.na(c7_2), 0, 1), # Se aislaría c7_2 == 2
         c7_3 = if_else(is.na(c7_3), 0, 1), # Utilizaría mascarilla c7_3 == 3
         c7_4 = if_else(is.na(c7_4), 0, 1),
         c7_5 = if_else(is.na(c7_5), 0, 1),
         c7_6 = if_else(is.na(c7_6), 0, 1)) 

# Se haría un un test (test rapido  auto aplicado, aplicado por otro o PCR)

movid_2022 <- 
  movid_2022 |> 
  mutate(c7_realizar_test = ifelse(c7_4 == 1 | c7_5 == 1 | c7_6 == 1, 1, 0))

# Comprobación
movid_2022 |> group_by(c7_1) |> tally()
movid_2022 |> group_by(c7_2) |> tally()
movid_2022 |> group_by(c7_3) |> tally()
movid_2022 |> group_by(c7_realizar_test) |> tally()

## Creación de un indice de respuesta a contacto estrecha
# Cada una de las acciones descrita anteriormente suma un punto al indice. 
movid_2022 <- 
  movid_2022 |> 
  mutate(indice_respuesta_contacto_estrecho_sin_sintomas = ifelse(c7_1 == 1, 0, c7_2+c7_3+c7_realizar_test))

# Comprobación
movid_2022 |> group_by(indice_respuesta_contacto_estrecho_sin_sintomas) |> tally()



# C8 respuesta a contacto estrecho con sintomas  ----------------------------------------


# Posibles respuestas (se recodifican para poder ser sumadas)
# *Tuve que usar NA como referencia para que funcionara el ifelse

movid_2022 <- 
  movid_2022 |> 
  mutate(c8_1 = if_else(is.na(c8_1), 0, 1), # No haría nada c8_1 == 1
         c8_2 = if_else(is.na(c8_2), 0, 1), # Se aislaría c8_2 == 2
         c8_3 = if_else(is.na(c8_3), 0, 1), # Utilizaría mascarilla c8_3 == 3
         c8_4 = if_else(is.na(c8_4), 0, 1),
         c8_5 = if_else(is.na(c8_5), 0, 1),
         c8_6 = if_else(is.na(c8_6), 0, 1)) 

# Se haría un un test (test rapido  auto aplicado, aplicado por otro o PCR)

movid_2022 <- 
  movid_2022 |> 
  mutate(c8_realizar_test = ifelse(c8_4 == 1 | c8_5 == 1 | c8_6 == 1, 1, 0))

# Comprobación
movid_2022 |> group_by(c8_1) |> tally()
movid_2022 |> group_by(c8_2) |> tally()
movid_2022 |> group_by(c8_3) |> tally()
movid_2022 |> group_by(c8_realizar_test) |> tally()

## Creación de un indice de respuesta a contacto estrecha
# Cada una de las acciones descrita anteriormente suma un punto al indice. 
movid_2022 <- 
  movid_2022 |> 
  mutate(indice_respuesta_contacto_estrecho_con_sintomas = ifelse(c8_1 == 1, 0, c8_2+c8_3+c8_realizar_test))

# Comprobación
movid_2022 |> group_by(indice_respuesta_contacto_estrecho_con_sintomas) |> tally()

#  ++ Creación de los objetos survey ------------------------------------------

## Usando paquete srvyr

movid_2022_s <- 
  movid_2022 %>% 
  as_survey_design(ids = 1, # No cluster
                   probs = NULL, # Probabilidad de los cluster
                   strata = NULL, # Formula con los estratos
                   weights = fact_exp)

## Usando paquete survey

# movid_2022_s <- svydesign(id = ~1, # No cluster
#                           probs = NULL, # Probabilidad de los cluster
#                           strata = NULL, # Formula con los estratos
#                           weights = ~fact_exp, 
#                           data = movid_2022)


```

```{r preparacion_bbdd_2020, include=FALSE}
#  ++ Lectura BBDD ------------------------------------------------------------

## Lectura bases 
movid_2020 <- read_dta("./input/2020/MOVID-IMPACT.dta")

## Limpieza nombres columnas 
movid_2020 <- janitor::clean_names(movid_2020)

## Selecciona a las personas efectivamente entrevistadas de la bbdd
movid_2020 <- movid_2020 %>% filter(entrevistado == 1)





# ++ Variables independientes ------------------------------------------------


# Sexo --------------------------------------------------------------------

# 1 hombre, 2 mujer
movid_2020 |> group_by(sexo) |> tally()


# Nivel educacional -------------------------------------------------------

# Opcion 1
movid_2020 <- movid_2020%>% 
  mutate(educ_2 = as.factor(case_when(
    a8a == 1 | a8a == 2 ~ "Nunca asistió",
    a8a == 3 | a8a == 4 ~ "Básica",
    a8a == 5 | a8a == 6 ~ "Media",
    a8a == 7 | a8a == 8 ~ "Superior",
    a8a == 9 ~ "Postgrado",
    TRUE ~ "NS/NR")))

# Opcion 2: Se recomienda usar esta por IC
movid_2020 <- movid_2020 %>% 
  mutate(educ_3 = as.factor(case_when(
    a8a == 1 | a8a == 2 | a8a ==  3 |a8a == 4 ~ "Básica o nunca asistió",
    a8a == 5 | a8a ==6 ~ "Media",
    a8a == 7 | a8a ==8 | a8a == 9 ~ "Superior o postgrado",
    TRUE ~ "NS/NR")))
movid_2020 |> group_by(educ_3) |> tally()

# Prevision de salud ------------------------------------------------------

movid_2020 <- 
  movid_2020 %>% 
  mutate(prevision = as.factor(
    case_when(
      b2 == 1 ~ "Fonasa",
      b2 == 2 ~ "Isapre",
      b2 == 5 ~ "Ninguna", 
      b2 == 3 | b2 == 4 ~ "Otra",
      b2 == 8 | b2 == 9 ~ "NS/NR")))

movid_2020 |> group_by(prevision) |> tally()


# Ocupados ----------------------------------------------------------------

movid_2020 <- 
  movid_2020 %>% 
  mutate(
    ocupacion_all = as.factor(case_when(
      g1 == 1 | g2 == 1 | g3 != 10 ~ "ocupados", 
      g4 == 2 & g5 == 1 ~ "busca_trabajo_primera_vez",
      g1 == 2 & g2 == 2 & g3 == 10 & g4  == 1 & g5 == 1 ~ "cesante",
      TRUE ~ "fuera_fuerza_trabajo")),
    ocupacion_d = as.factor(case_when(
      g1 == 1 | g2 == 1 | g3 != 10 ~ "ocupados",
      (g4 == 2 & g5 == 1) | (g1 == 2 & g2 == 2 & g3 == 10 & g4  == 1 & g5 == 1) ~ "desocupados",
      TRUE ~ "fuera_fuerza_trabajo")))

# Importante: La desagregacion por cesante  y busca trabajo por primera vez no es 
# posible hacerla en la encuesta 2022. 


### Fuerza de trabajo (ocupados y personas que buscan trabajo mayores de 15 anos)
## Ocupados 
# g1 == 1 |(g1 == 2 & g2 == 1) | (g1 == 2 & g2 == 2 & g3 != 10) 
## Desocupados (Buscan trabajo por primera vez  y Cesantes)
# Buscan trabajo por primera vez
# g4 == 2 & g5 == 1
# Cesantes  
# g1 == 2 & g2 == 2 & g3 == 10 & g4  == 1 & g == 1



# Tramo etario ------------------------------------------------------------

# Opcion 1: Desagregacion completa
movid_2020$edad_rec <- cut(movid_2020$edad,
                           include.lowest = TRUE,
                           right = TRUE,
                           breaks = c(18, 24, 34, 44, 54, 64, 80, Inf)
)

movid_2020 |> group_by(edad_rec) |> tally()

# Opcion 2: Desagregacion reducida (recomendable por IC)
movid_2020 <- movid_2020 %>% 
  mutate(edad_2 = as.factor(case_when(
    edad < 30 ~ "18 a 29 años",
    edad >= 30 & edad < 60 ~ "30 a 59 años",
    edad >= 60 ~ "60 años o más"
  )))



# Nivel de ingresos -------------------------------------------------------

# Se pregunta por ingresos del hogar, pero no se sabe de cuantas personas es el hogar, por lo tanto
# No se puede obtener ingreso percapita. 
# Por lo tanto, no se recomienda usar esta variable para análisis. 

# g47 responde nivel de ingresos continuo del hogar ? si/no
movid_2020 |> group_by(g47) |> tally()

# g47 monto ingresos continuo
movid_2020 |> group_by(g47_monto) |> tally()

# g48 Tramo ingresos
movid_2020 |> group_by(g48) |> tally()

# Conversion de tramos de ingresos a media de ingresos (variable continua)
movid_2020 <- 
  movid_2020 |> 
  mutate(tramo_ingresos_continuo = case_when(
    g48 == 1 ~ 100000,
    g48 == 2 ~ 275000,
    g48 == 3 ~ 425000,
    g48 == 4 ~ 650000,
    g48 == 5 ~ 1000000,
    g48 == 6 ~ 1600000,
    g48 == 7 ~ 3500000,
    g48 == 8 ~ 6000000
  ))

# Ingreso hogar total (con estimacion de ingresos continuos)
movid_2020 <- 
  movid_2020 |> 
  mutate(ingreso_hogar_completo = ifelse(g47 == 1, g47_monto, tramo_ingresos_continuo))

# Ingresos hogar por tramo de ingreso 

movid_2020$tramo_ingresos_hogar_completo <- cut(movid_2020$ingreso_hogar_completo,
                                                include.lowest = TRUE,
                                                right = TRUE,
                                                ordered_result = TRUE,
                                                labels = levels(haven::as_factor(movid_2020$g48))[1:8],
                                                breaks = c(0,
                                                           200000, 
                                                           350000, 
                                                           500000, 
                                                           800000, 
                                                           1200000, 
                                                           2000000, 
                                                           5000000,
                                                           Inf))

# Se agrega categoria NS/NR a la clasificacion anterior
movid_2020 <- 
  movid_2020 |> 
  mutate(tramo_ingresos_hogar_completo = ifelse(is.na(tramo_ingresos_hogar_completo), 
                                                "NS/NR", 
                                                as.character(tramo_ingresos_hogar_completo)))
# Se transforma en factor
movid_2020$tramo_ingresos_hogar_completo <- 
  factor(movid_2020$tramo_ingresos_hogar_completo, 
         levels = c(levels(haven::as_factor(movid_2020$g48))[1:8], "NS/NR"))

# Variable final con el tramo de ingresos del hogar completo (visualizacion)
movid_2020 |> group_by(tramo_ingresos_hogar_completo) |>  tally()


# Enfermedad cronica ------------------------------------------------------

# IMPORTANTE: La pregunta de enfermedad crónica en año 2020 (c1) y 2022 (b2) difiere entre cuestionarios. 
# Se consideraron condiciones de salud mental como enfermedad crónica. 

# Reemplazar NA por 0 para que funcione bien ifelse

movid_2020 <- 
  movid_2020 |> 
  mutate(across(starts_with("c1"), ~ifelse(is.na(.), 0, .)))

# Personas con enfermedad cronica. 1 = 1  o más enfermedad cronicas / 0 = Sin enfermedad crónica. 
movid_2020 <- 
  movid_2020 |> 
  mutate(cronica_d = ifelse(c1_1 == 1 | c1_2 == 2 | c1_3 == 3  | c1_4 == 4 |
                            c1_5 == 5 | c1_6 == 6, 1, 0))
movid_2020 |> group_by(cronica_d) |> tally()

# Region ------------------------------------------------------------------

# Ordenando region (no funciona)
# movid_2020$region <- 
#   ordered(movid_2020$region, 
#           levels = c(15, 1, 2, 3, 4, 5 ,6 ,7, 16, 8 , 9, 14, 10, 11, 12, 13), 
#           labels=c("Región de Arica y Parinacota", "Región de Tarapacá", "Región de Antofagasta", 
#                    "Región de Atacama", "Región de Coquimbo","Región de Valparaíso", "Región de O'Higgins",                     
#                    "Región del Maule", "Región de Ñuble", "Región del Bío Bío", "Región de la Araucanía",                  
#                    "Región de los Ríos", "Región de los Lagos", "Región de Aysén",  "Región de Magallanes y Antártica Chilena",
#                    "Región Metropolitana de Santiago"))          

movid_2020 %>% group_by(region) %>% tally()

# Región Poblacion
movid_2020 <- movid_2020 %>% mutate(region_d = as.factor(ifelse(region == 13, "RM", "Otra region")))
movid_2020 %>% group_by(region_d) %>% tally()

#  ++ Creación variables dependientes ----------------------------------------

# F3: Modulo social -----------------------------------------------------------

# Ojo, las escalas estan con numeracion al reves que el año 2022.
movid_2020 <- 
  movid_2020 |> 
  mutate(across(starts_with("f3_"), 
                ~case_when(. %in% c(4:5) ~ "De acuerdo o muy de acuerdo",
                           . %in% c(3) ~ "Indiferente",
                           . %in% c(1:2) ~ "En desacuerdo o muy en desacuerdo",
                           . %in% c(8:9) ~ "NS/NR"),
                .names = "{.col}_recoded"))

# Comprobacion
movid_2020 |> select(starts_with("f3_") & ends_with("recoded"))




# Pospuso tratamiento -----------------------------------------------------

movid_2020 <- 
  movid_2020 |> 
  mutate(pospuso_tratamiento = case_when(
    e1_1 == 1 | e1_2 == 1 | e1_3 == 1 | e1_4 == 1 | e1_5 == 1 | e1_6 == 1 ~ "Pospuso tratamiento",
    e1_1 == 2 | e1_2 == 2 | e1_3 == 2 | e1_4 == 2 | e1_5 == 2 | e1_6 == 2 ~ "No  pospuso tratamiento",
    e1_1 >= 8 | e1_2 >= 8 | e1_3 >= 8 | e1_4 >= 8 | e1_5 >= 8 | e1_6 >= 8 ~ "NS/NR"
  ))


# Razon pospuso tratamiento -----------------------------------------------

# Razon por la que pospuso el tratamiento para el primer tratamiento que pospuso siguiendo el orden de la siguiente lista
# basada en C1:Diabetes, hipertension, infarto, enfermedad respiratorioa, depresión u otra. 

movid_2020 <- 
  movid_2020 |> 
  mutate(razon_pospuso_tratamiento = case_when(
    e2_1 >= 1 ~ e2_1,
    e2_2 >= 1 ~ e2_2,
    e2_3 >= 1 ~ e2_3,
    e2_4 >= 1 ~ e2_4,
    e2_5 >= 1 ~ e2_5,
    e2_6 >= 1 ~ e2_6
  ))

movid_2020 |> group_by(razon_pospuso_tratamiento) |> tally()


# Indice de salud mental --------------------------------------------------

# El PHQ-4, como una herramienta de detección rápida para la depresión y la ansiedad, se puede utilizar para construir un índice de salud mental rudimentario. Aquí está una manera de cómo se puede hacer esto:
#   
# El PHQ-4 consta de cuatro preguntas con cuatro opciones de respuesta: "Nada en absoluto", "Varios días", "Más de la mitad de los días", y "Casi todos los días", que se puntúan de 0 a 3 respectivamente.
# 
# Por lo tanto, el rango total de puntajes posibles para el PHQ-4 va de 0 (sin síntomas de ansiedad o depresión) a 12 (síntomas muy severos de ansiedad y depresión).
# 
# La interpretación generalmente aceptada de los puntajes del PHQ-4 es la siguiente:
#   
# Un puntaje de 0 a 2 indica no hay síntomas de ansiedad ni depresión.
# Un puntaje de 3 a 5 indica posibles síntomas de ansiedad o depresión.
# Un puntaje de 6 a 8 indica síntomas moderados de ansiedad y/o depresión.
# Un puntaje de 9 a 12 indica síntomas severos de ansiedad y/o depresión.
# 
# Entonces, este puntaje puede ser utilizado como un índice básico de salud mental. Sin embargo, es importante recordar 
# que este índice solo ofrece una visión general de la presencia y gravedad de los síntomas de ansiedad y depresión. 
# No aborda otros aspectos de la salud mental y no debe ser utilizado para diagnosticar trastornos de ansiedad o depresión. 
# Para un diagnóstico y evaluación completos de la salud mental, se necesita un profesional de salud mental.



# En este caso, se va a IMPUTAR la no respuesta con la moda para cada pregunta 


# Imputacion de NS/NR

# Obtener la moda sin considera NS/NR
moda_c2_1 <- moda(movid_2020$c2_1[movid_2020$c2_1 != 8 & movid_2020$c2_1 != 9])
moda_c2_2 <- moda(movid_2020$c2_2[movid_2020$c2_2 != 8 & movid_2020$c2_2 != 9])
moda_c2_3 <- moda(movid_2020$c2_3[movid_2020$c2_3 != 8 & movid_2020$c2_3 != 9])
moda_c2_4 <- moda(movid_2020$c2_4[movid_2020$c2_4 != 8 & movid_2020$c2_4 != 9])

# Reemplazar los valores 8 y 9 con la moda
movid_2020 <- movid_2020 |> 
  mutate(c2_1 = case_when(c2_1 == 8 ~ moda_c2_1,
                          c2_1 == 9 ~ moda_c2_1,
                          TRUE ~ c2_1),
         c2_2 = case_when(c2_2 == 8 ~ moda_c2_2,
                          c2_2 == 9 ~ moda_c2_2,
                          TRUE ~ c2_2),
         c2_3 = case_when(c2_3 == 8 ~ moda_c2_3,
                          c2_3 == 9 ~ moda_c2_3,
                          TRUE ~ c2_3),
         c2_4 = case_when(c2_4 == 8 ~ moda_c2_4,
                          c2_4 == 9 ~ moda_c2_4,
                          TRUE ~ c2_4))

# Calcular el indice con los valores imputados
movid_2020 <-
  movid_2020 |>
  mutate(phq_4 = as.numeric(c2_1+c2_2+c2_3+c2_4-4)) # Se resta 4 porque la escala original va de 0 a 3, no de 1 a 4 como en esta BBDD. 

print(movid_2020 |> group_by(phq_4) |> tally(), n = 13)



# Ahora se presenta en una escala categorica

movid_2020 <- 
  movid_2020 |> 
  mutate(phq_4_categorico = case_when(phq_4 <= 2 ~ "No hay síntomas de ansiedad ni depresión",
                                      phq_4 <= 5 ~ "Posibles síntomas de ansiedad o depresión",
                                      phq_4 <= 8 ~ "Síntomas moderados de ansiedad y/o depresión",
                                      phq_4 <= 12 ~ "Síntomas severos de ansiedad y/o depresión"))




#  ++ Creación de los objetos survey ------------------------------------------

## Usando paquete srvyr

movid_2020_s <- 
  movid_2020 %>% 
  as_survey_design(ids = 1, # No cluster
                   probs = NULL, # Probabilidad de los cluster
                   strata = NULL, # Formula con los estratos
                   weights = factor_expansion)

## Usando paquete survey

# movid_2020_s <- svydesign(id = ~1, 
#                          weights = ~fact_exp, 
#                          data = movid_2020,
#                          strata = NULL,
#                          fpc= NULL,
#                          probs = NULL)

```

\newpage

## Introducción

Los proyectos MOVID-19 (Monitoreo Nacional de Síntomas y Prácticas COVID-19) y CoV-IMPACT-C: "Impacto del COVID-19 en Chile" surgieron como respuesta a la pandemia, que ha generado una emergencia sanitaria, económica y social a nivel global. Estos proyectos tienen como objetivo analizar, desde una perspectiva transdisciplinaria, la evolución de la pandemia, la respuesta del sistema de salud y la política pública, así como las consecuencias sanitarias y sociales, considerando sus múltiples interrelaciones.

En el marco de estos proyectos, se llevaron a cabo las encuestas MOVID-IMPACT, que tienen representatividad nacional y buscan recopilar información relevante sobre el comportamiento de las personas durante la crisis sanitaria en diversas áreas, como vacunación, seguimiento de normas, acceso a salud y empleo.


## Metodología de la encuesta

La encuesta MOVID-IMPACT se realizó en dos fases: diciembre de 2020 y junio de 2022, a través de entrevistas telefónicas con un representante de cada hogar. La muestra es representativa de la población adulta urbana mayor de 18 años que reside en viviendas particulares en áreas urbanas de Chile. La metodología utilizada fue un estudio transversal basado en un marco muestral secundario, derivado del último Censo de Población y Viviendas realizado por el INE en 2017. Se obtuvieron muestras de 1.261 y 1.247 personas para los años 2020 y 2022, respectivamente.

El diseño muestral se estratificó según el área geográfica y el tamaño de la población, con un total de 47 estratos. Dentro de cada estrato, se seleccionaron viviendas mediante muestreo aleatorio sistemático y se entrevistó a un adulto elegido al azar. El tamaño de la muestra se estableció en 1.200 entrevistas efectivas para limitar el error muestral al 2,8% a nivel nacional urbano. Se sobredimensionó la muestra en aproximadamente un 80% para compensar posibles pérdidas debido a la falta de respuesta.

Los criterios de inclusión fueron tener más de 18 años y ser residente de viviendas particulares urbanas. Los criterios de exclusión incluyeron a residentes en Áreas de Difícil Acceso (ADA) y hogares sin teléfono fijo o móvil. Para aumentar la representatividad de los resultados, se aplicaron factores de expansión, corrección por falta de respuesta y post-estratificación.

Los cuestionarios utilizados en ambas encuestas fueron diferentes, ya que se diseñaron para diferentes etapas de la pandemia. La principal diferencia radicó en que la encuesta de 2022 se centró en analizar el proceso de vacunación de la población chilena. Ambos cuestionarios abordaron temas como demografía, enfermedades preexistentes, acceso a atención médica para COVID-19 y no COVID-19, aspectos sociales y empleo, aunque hubo variaciones en las preguntas según su relevancia en el avance de la pandemia.

Para obtener más detalles sobre la metodología, se puede revisar la documentación del proyecto en el siguiente [enlace](https://movid-impact.netlify.app/doc/).

## Análisis por temática 

### 1. Discontinuidad de tratamientos en pacientes crónicos

La rápida expansión de la enfermedad causada por el virus COVID-19 puso bajo una gran presión al sistema de salud del país, que se vio obligado a reasignar recursos y personal médico a la atención de la emergencia, lo que resultó en la postergación de otros tipos de atención.

En la encuesta realizada en 2020, se consultó a las personas que padecían alguna enfermedad crónica si habían tenido que posponer algún control o tratamiento médico en los últimos tres meses (e1). Se encontró que un 40% (IC95% 35.9-45.0) de las personas habían tenido que posponer algún tratamiento entre septiembre y diciembre de 2020.

No se observaron diferencias significativas en función del sexo y el tramo etario con respecto a esta variable.

```{r pospuso_tratamiento, echo=FALSE, fig.align='center', warning=FALSE, fig.width=6, fig.height=5, message = FALSE  }

pospuso_tratamiento <- 
  movid_2020_s |> 
  filter(cronica_d == 1) |> 
  group_by(pospuso_tratamiento) |> 
  summarize(proportion = survey_mean(vartype = "ci"))

pospuso_tratamiento_sexo <- 
movid_2020_s |> 
  filter(cronica_d == 1) |> 
  group_by(sexo, pospuso_tratamiento) |> 
  summarize(proportion = survey_mean(vartype = "ci")) |> 
  mutate(sexo = recode(as.factor(sexo), '1' = "Hombre", '2' = "Mujer"))

pospuso_tratamiento_edad <- 
movid_2020_s |> 
  filter(cronica_d == 1) |> 
  group_by(edad_2, pospuso_tratamiento) |> 
  summarize(proportion = survey_mean(vartype = "ci"))

graph_barras_bivariado(pospuso_tratamiento_sexo,
                       titulo = "Tratamientos pospuestos año 2020",
                       subtitulo = "Personas con enfermedad crónica  que pospusieron tratamiento según sexo")

graph_barras_bivariado(pospuso_tratamiento_edad,
                       titulo = "Tratamientos pospuestos año 2020",
                       subtitulo = "Personas con enfermedad crónica  que pospusieron tratamiento según tramo etario")
```

Respecto a las razones por las cuales se pospusieron los controles o atenciones de salud, se destacan dos motivos principales. En primer lugar, un 31.8% (IC95% 24.1-39.4) de las personas indicaron que lo hicieron por miedo a contagiarse de COVID-19. En segundo lugar, un 51.2% (IC95% 43.1-59.3) mencionó que su cita en el consultorio, hospital o clínica fue suspendida y aún no ha sido reprogramada. Por lo tanto, se puede afirmar que al menos el 80% de las postergaciones están relacionadas de alguna manera con la crisis sanitaria.

```{r razon_pospuso_tratamiento, echo=FALSE, fig.align='center', warning=FALSE, fig.width=6, fig.height=5, message = FALSE  }

razon_pospuso_tratamiento <- 
  movid_2020_s |> 
  filter(cronica_d == 1, pospuso_tratamiento == "Pospuso tratamiento") |> 
  group_by(razon_pospuso_tratamiento) |> 
  summarize(proportion = survey_mean(vartype = "ci")) |> 
  mutate(razon_pospuso_tratamiento = recode(as.factor(razon_pospuso_tratamiento),
                                            '1' = "Porque no le pareció importante controlarse",
                                            '2' = "Por el costo econó- mico",
                                            '4' = "Porque tenía que esperar mucho tiempo",
                                            '5' = "Por miedo a contagiarse de COVID-19",
                                            '6' = "Porque el sistema de salud está muy lleno",
                                            '7' = "No contó con trasporte para trasladarse al lugar de atención",
                                            '8' = "No tuvo con quien dejar a personas a su cuidado",
                                            '9' = "El consultorio, hospital o clínica le suspendió la hora y no le ha reagendado",
                                            '10' = "Otro",
                                            '98' = "No sabe"))
graph_barras_univariado(razon_pospuso_tratamiento,
                        titulo = "Razón por la que se pospuso el tratamiento",
                        ancho_texto_x = 7)
```

Al examinar con mayor detalle los tratamientos pospuestos, se identifica lo siguiente: el 22.9% (IC95% 18.9-26.9) de los pacientes crónicos tuvieron que postergar una consulta médica, el 13.1% (IC95% 9.9-16.3) tuvo que posponer algún examen de laboratorio o imagenológico, y un 1.9% (IC95% 0.6-3.1) tuvo que retrasar una cirugía electiva. Estos datos destacan las diferentes áreas de atención médica que se vieron afectadas por la necesidad de postergar los tratamientos debido a la crisis sanitaria.

```{r detalle_tratamientos_pospuestos, echo=FALSE, fig.align='center', warning=FALSE, fig.width=6, fig.height=5, message = FALSE  }

# Pacientes cronicos que tuvieron que posponer alguna de las sigientes atenciones de salud planificadas
# en los últimos 3 meses. 

# Consultas médicas
postergacion_consultas_medicas <- 
movid_2020_s |> 
  filter(cronica_d == 1, !is.na(e5_1), e5_1 %in% c(1:2)) |> 
  group_by(e5_1) |> 
  summarize(proportion = survey_mean(vartype = "ci"))

# Toma de examenes de laboratorio o imagenológicos
postergacion_examenes <- 
movid_2020_s |> 
  filter(cronica_d == 1, !is.na(e5_4), e5_4 %in% c(1:2)) |> 
  group_by(e5_4) |> 
  summarize(proportion = survey_mean(vartype = "ci"))

# Cirugías electivas
postergacion_cirugias_electivas <- 
movid_2020_s |> 
  filter(cronica_d == 1, !is.na(e5_8), e5_8 %in% c(1:2)) |> 
  group_by(e5_8) |> 
  summarize(proportion = survey_mean(vartype = "ci"))
```

Al desagregar los datos por previsión de salud (Fonasa e Isapre), no se observaron diferencias significativas. Por ejemplo, entre las personas afiliadas a Fonasa, un 23.0% (IC95% 18.5-27.6) pospuso una consulta médica, mientras que entre las personas afiliadas a una Isapre, un 24.8% (IC95% 14.6-35.0) pospuso un tratamiento. Estos resultados indican que no hay diferencias significativas en la proporción de personas que postergaron sus tratamientos según su previsión de salud.

```{r tratamientos_pospuestos_prevision_salud, echo=FALSE, fig.align='center', warning=FALSE, fig.width=6, fig.height=5, message = FALSE  }

# Consultas médicas segun fonasa  o isapre en pacientes crónicos
postergacion_consultas_medicas_prevision <- 
movid_2020_s |> 
  filter(cronica_d == 1, !is.na(e5_1), e5_1 %in% c(1:2), prevision %in% c("Fonasa", "Isapre")) |> 
  group_by(prevision, e5_1) |> 
  summarize(proportion = survey_mean(vartype = "ci")) |> 
  mutate(e5_1 = recode(as_factor(e5_1), 
                       'Sí' = "Pospuso consulta",
                       'No' = "No pospuso consulta"))

# Toma de examenes de laboratorio o imagenológicos segun fonasa  o isapre en pacientes crónicos
postergacion_examenes_prevision <- 
movid_2020_s |> 
  filter(cronica_d == 1, !is.na(e5_4), e5_4 %in% c(1:2), prevision %in% c("Fonasa", "Isapre")) |> 
  group_by(prevision, e5_4) |> 
  summarize(proportion = survey_mean(vartype = "ci"))

# Cirugías electivas segun fonasa  o isapre en pacientes crónicos
postergacion_cirugias_electivas_prevision <- 
movid_2020_s |> 
  filter(cronica_d == 1, !is.na(e5_8), e5_8 %in% c(1:2), prevision %in% c("Fonasa", "Isapre")) |> 
  group_by(prevision, e5_8) |> 
  summarize(proportion = survey_mean(vartype = "ci"))

graph_barras_bivariado(postergacion_consultas_medicas_prevision,
                       titulo = "Consultas médicas pospuestas año 2020",
                       subtitulo = "Personas con enfermedad crónica que pospusieron consulta médica según previsión")

```

### 2. Discontinuidad de exámenes diagnósticos asociados a cancer  

En cuanto a la discontinuidad de exámenes diagnósticos asociados al cáncer, como el Papanicolaou, mamografías u otros en mujeres, y antígeno prostático, colonoscopía u otros en hombres, se observa lo siguiente: un 9.63% (IC95% 7.0-12.2) de las mujeres tuvo que posponer algún examen relacionado en los últimos 3 meses (septiembre a diciembre de 2020). Las principales razones declaradas fueron "El consultorio, hospital o clínica le suspendió la hora y no le ha reagendado" y "Por miedo a contagiarse", que en conjunto representan más de la mitad de los casos. 

```{r examen_cancer_pospuesto_mujeres, echo=FALSE, fig.align='center', warning=FALSE, fig.width=6, fig.height=5, message = FALSE  }

# Disontiuidad  papanicolau, mamografías u otros (solo mujeres)
examen_cancer_pospuesto_mujeres <- 
  movid_2020_s |> 
  filter(!is.na(e5_5), e5_5 %in% c(1:2), sexo == 2) |> 
  group_by(e5_5) |> 
  summarize(proportion = survey_mean(vartype = "ci"))

# Razon de la discontinuidad 
razon_examen_cancer_pospuesto_mujeres <- 
movid_2020_s |> 
  filter(e5_5 == 1, sexo == 2, !e6==98) |> 
  group_by(e6) |> 
  summarize(proportion = survey_mean(vartype = "ci")) |> 
  mutate(e6 = recode(as.factor(e6), 
                     '1' = "Porque no le pareció importante",
                     '2' = "Por el costo económico",
                     '6' = "Por miedo a contagiarse",
                     '8' = "Porque el sistema de salud está muy lleno",
                     '11' = " El consultorio, hospital o clínica le suspendió la hora y no le ha reagendado",
                     '12' = "Otra"))

graph_barras_univariado(razon_examen_cancer_pospuesto_mujeres,
                        titulo = "Postergación examenes en mujeres año 2020",
                       subtitulo = "Razón postergación exámenes asociados a cancer en mujeres",
                       ancho_texto_x = 10)

```

En el caso de los hombres, se reconoce que un 4.3% (IC95% 2.4-6.3) de la población masculina tuvo que posponer algún examen relacionado al cáncer en los últimos 3 meses (septiembre a diciembre de 2020). Las principales razones por las cuales se pospuso el examen fueron "Por miedo a contagiarse" y "Porque el sistema de salud está muy lleno". 

```{r examen_cancer_pospuesto_hombres, echo=FALSE, fig.align='center', warning=FALSE, fig.width=6, fig.height=5, message = FALSE  }

# Disontiuidad  antigeno prostaico, colonoscopía u otros (solo hombres)
examen_cancer_pospuesto_hombres <- 
  movid_2020_s |> 
  filter(!is.na(e5_6), e5_6 %in% c(1:2), sexo == 1) |> 
  group_by(e5_6) |>   
  summarize(proportion = survey_mean(vartype = "ci"))

# Razon de la discontinuidad 
razon_examen_cancer_pospuesto_hombres <- 
movid_2020_s |> 
  filter(e5_6 == 1, sexo == 1) |> 
  group_by(e6) |> 
  summarize(proportion = survey_mean(vartype = "ci"))|> 
  mutate(e6 = recode(as.factor(e6), 
                     '3' = "Porque no sabía dónde realizarlas",
                     '6' = "Por miedo a contagiarse",
                     '7' = "Porque los síntomas son leves o habituales",
                     '8' = "Porque el sistema de salud está muy lleno",
                     '10' = "No tuvo con quien dejar a personas a su cuidado",
                     '11' = " El consultorio, hospital o clínica le suspendió la hora y no le ha reagendado",
                     '12' = "Otra"))

graph_barras_univariado(razon_examen_cancer_pospuesto_hombres,
                       titulo = "Postergación examenes en hombres año 2020",
                       subtitulo = "Razón postergación exámenes asociados a cancer en hombres",
                       ancho_texto_x = 10)

```


Al respecto, se reconoce que entre las mujeres hubo un mayor número de examenes pospuestos, , lo cual podría estar relacionado con el hecho de que una mayor proporción de la población femenina se realiza exámenes preventivos con regularidad. Esta mayor conciencia de la importancia de los exámenes preventivos puede llevar a una mayor postergación cuando se presentan circunstancias adversas.

Además, se observa una diferencia en las razones por las que se pospusieron los exámenes entre hombres y mujeres. Entre las mujeres, la principal razón fue que "El consultorio, hospital o clínica le suspendió la hora y no le ha reagendado", mientras que en el caso de los hombres, la principal razón fue "Por miedo a contagiarse". Esto sugiere que en el caso de las mujeres, los exámenes fueron pospuestos debido a circunstancias externas a su voluntad, como la suspensión de las citas por parte del sistema de salud. En cambio, en el caso de los hombres, la postergación de los exámenes fue una decisión personal motivada principalmente por el temor a contagiarse.

Estas diferencias en las razones subyacentes podrían reflejar distintos factores contextuales y percepciones individuales que influyen en la toma de decisiones relacionadas con la salud y la postergación de los exámenes preventivos.

### 3. Discontinuidad del programa de inmunizaciones y control de niño sano

En el capítulo 1 ya se entregaron algunos antecedentes que permiten reconocer las dificultades de los pacientes adultos a recibir sus  tratamientos, consultas y examenes planificados a  causa de la pandemia por COVID-19 (año 2020). Una de las principales razones declaradas por las personas para no poder continuar con sus tratamientos fue la anulación o postergación de las citas por parte de los centros de salud, debido a la saturación de los establecimientos y la necesidad de redirigir recursos y personal de salud hacia la atención de la emergencia.

En este sentido, es posible que estos problemas se hayan extendido a las atenciones de salud enfocadas en los niños, como el programa de control de niño sano y el programa de inmunizaciones. Esta situación puede haberse visto agravada por el cierre de los recintos escolares.

Lamentablemente, la encuesta no incluyó preguntas específicas que permitieran profundizar en esta temática y obtener datos más detallados sobre la discontinuidad en el programa de control de niño sano y el programa de inmunizaciones.

#### Programa Control Niño Sano

El programa de Control Niño Sano, según se informa en la web oficial de [Chile Crece Contigo](https://www.crececontigo.gob.cl/beneficios/control-de-salud-de-nino-y-nina-sano-en-establecimientos-educacionales/),  es un beneficio que permite realizar controles de salud a niños y niñas a partir de los 5 años, tanto en los centros de salud como en los establecimientos educacionales. Estos controles incluyen la evaluación del desarrollo integral y crecimiento del niño o niña, así como la orientación y resolución de dudas que tengan los padres, madres o cuidadores.

Entre las actividades que se realizan en el control se encuentran la revisión de antecedentes generales y de riesgo biopsicosocial, el examen físico cefalocaudal, la revisión dental, la evaluación del crecimiento y desarrollo, el control de la presión arterial, la evaluación de la visión, audición y función respiratoria, y la revisión del plan de vacunación. Además, se realizan derivaciones al centro de salud según las problemáticas detectadas y se trabaja en colaboración con los profesores, capacitándolos en temas de salud y riesgos.

#### Programa de inmunizaciones

Como se indica en la web oficial del Programa Nacional de Inmunizaciones [PNI](https://vacunas.minsal.cl/informacion-a-la-comunidad/obligatoriedad-de-la-vacunacion/), este programa está destinado a prevenir morbilidad, discapacidad y mortalidad por enfermedades infecciosas transmisibles inmunoprevenibles utilizando un conjunto de vacunas destinadas a proteger a la población a lo largo de todo el ciclo vital, las cuales se constituyen en bienes públicos. Su fin es contribuir a mantener y mejorar la salud de la población y su propósito es controlar la morbilidad y mortalidad por enfermedades transmisibles prevenibles por vacunas (inmunoprevenibles) que han sido definidas como parte del PNI, en concordancia con recomendaciones internacionales.

En el caso de los lactantes, se aplican vacunas como: 

 - BCG
 - Hepatitis B
 - Hexavalente
 - Neumocócica conjugada 13 valente
 - Meningocócica conjugada A, C, W-135, Y
 - SRP (Sarampión, Rubéola y Parotiditis)
 - Hepatitis A
 - Varicela
 - Fiebre amarilla
 
Para los preescolares y escolares, se administran vacunas como: 
 
- SRP (Sarampión, Rubéola y Parotiditis)
- dTp (acelular)
- VPH
- Varicela



### 4. Disposición vacunal en adultos (mayores de 18 años) 

En cuanto a la disposición vacunal en adultos, ya se han realizado distintos análisis de esta temática utilizando los resultados de la encuesta. Por ejemplo, en el "Informe Resultados Encuesta Movid-Impact 2022" (2022), se analizó la disposición vacunal de adultos según tipología de disposición vacunal, utilizando los resultados de la encuesta en su versión 2022. 

A modo de complemento, en el presente informe  se incorporan nuevos elementos que permiten complementar los datos ya expuestos. 

Según los resultados de la encuesta, a junio de 2022 el 96.4% (IC95%  95.0-97.8) de los adultos mayores de 18 años  habría completado su **esquema de vacunación inicial**. 


#### Razones por las que no se vacunarían aquellas personas que no tienen su esquema al día 

Adicionalmente, se consultó a aquellos individuos cuyo esquema de vacunación no estaba al día, de acuerdo con los lineamientos establecidos por la autoridad sanitaria. A estas personas se les preguntó sobre la probabilidad de que se vacunaran en las próximas dos semanas, permitiendo así identificar a aquellos que mostraban poca o nula probabilidad de completar su esquema de vacunación. Posteriormente, a este grupo renuente a completar su vacunación se les solicitó que proporcionaran la o las razones que motivaban su decisión (cada persona podía seleccionar más de una razón).

De esta manera, se identifico que entre las principales razones por las que no se vacunarían estas personas se encontraban: 

1. Preocupación por los posibles efectos de la vacuna
2. Prefiere esperar a ver que la vacuna sea segura
3. Estar en contra de las vacunas en general
4. Incredulidad respecto a la efectividad de la vacuna contra el coronavirus



```{r razones_no_vacunacion, echo=FALSE, fig.align='center', warning=FALSE, fig.width=6, fig.height=5, message = FALSE  }

## ¿Por qué razon no se han vacunado?
# Solo aquellas personas que en d7 respondiendo que "4. Es poco probable que me vacune" o 
# "5. No me vacunaría por ningún motivo". 

razones_no_vacunacion <- c("d8_a", "d8_b","d8_c", "d8_d", "d8_e", "d8_f","d8_g", "d8_h", "d8_i")

# Tabulados razones de no vacunacion. OJO, la funcion utilizada esta en script 1
tabulados_razones_no_vacunacion <- map(razones_no_vacunacion, ~calculo_razones_no_vacunacion(movid_2022_s, .x))

# Seleccion de los principales (principales razones mencioandas) (d, e, f, h)
tabulados_razones_no_vacunacion_main <- c(tabulados_razones_no_vacunacion[4:6], tabulados_razones_no_vacunacion[8])

# Renombrar columnas 
for (i in c(1:4)){
  names(tabulados_razones_no_vacunacion_main[[i]]) <-  c("si_no", "proportion", "proportion_low", "proportion_upp")
  tabulados_razones_no_vacunacion_main[[i]] <- 
    tabulados_razones_no_vacunacion_main[[i]] |> 
    mutate(si_no = recode(as.factor(si_no), 
                          '1' = "Si",
                          '2' = "No"))
}


tabulados_razones_no_vacunacion_main[[1]] <- 
  tabulados_razones_no_vacunacion_main[[1]] |> 
  mutate(razon = "Preocupación posibles efectos adversos de la vacuna") |> 
  select(razon, everything())

tabulados_razones_no_vacunacion_main[[2]] <- 
  tabulados_razones_no_vacunacion_main[[2]] |> 
  mutate(razon = "No está seguro que la vacuna funcione contra el coronavirus") |> 
  select(razon, everything())

tabulados_razones_no_vacunacion_main[[3]] <- 
  tabulados_razones_no_vacunacion_main[[3]] |> 
  mutate(razon = "Prefiere esperar a ver que la vacuna sea segura") |> 
  select(razon, everything())

tabulados_razones_no_vacunacion_main[[4]] <- 
  tabulados_razones_no_vacunacion_main[[4]] |> 
  mutate(razon = "Está en contra de las vacunas en general") |> 
  select(razon, everything())

tabulados_razones_no_vacunacion_df <- rbind(tabulados_razones_no_vacunacion_main[[1]], 
                                            tabulados_razones_no_vacunacion_main[[2]],
                                            tabulados_razones_no_vacunacion_main[[3]],
                                            tabulados_razones_no_vacunacion_main[[4]])

# Gráficos

graph_barras_bivariado(tabulados_razones_no_vacunacion_df,
                       titulo = "Razones no vacunación año 2022",
                       subtitulo = "¿Por qué razón o razones es poco o nada probable que ud. se vacune?",
                       ancho_texto_x = 10)



```

####  Explorando percepciones y obstáculos respecto a la vacunación contra el COVID-19 

Por otro lado, la encuesta consultó a las personas sobre diversas opiniones relacionadas con el proceso de vacunación, como la seguridad de las vacunas o la confianza en las autoridades. A continuación, se presenta la distribución de algunas de estas preguntas en la población general y desagregada por sexo, tramo etario y principales medios de información. Es importante mencionar que no se realizó una desagregación por estado de vacunación debido a que la subpoblación no vacunada es muy pequeña en la muestra de la encuesta, lo que generaría intervalos de confianza demasiado amplios para esos cruces.

En términos generales, se reconoce que el 79.4% (IC95% 76.6-82.1) de la población mayor de 18 años estaría de acuerdo en que las vacunas contra el COVID-19 son seguras. Este resultado refleja una aceptación mayoritaria de la seguridad de las vacunas en la población encuestada.

```{r confianza_vacunas, echo=FALSE, fig.align='center', warning=FALSE, fig.width=6, fig.height=5, message = FALSE  }

# Confianza en la seguridad de las vacunas
confianza_vacunas <- 
movid_2022_s |> 
  filter(!d12_1_recoded == "NS/NR") |> 
  group_by(d12_1_recoded) |> 
  summarize(proportion = survey_mean(vartype = "ci"))

graph_barras_univariado(confianza_vacunas,
                       titulo = "Confianza vacunas COVID-19 año 2022",
                       subtitulo = "Confío en que las vacunas contra el COVID-19 son seguras",
                       ancho_texto_x = 10)


```

Un porcentaje similar, 78,1% (IC95% 75.1-81.1), confía en que las autoridades sanitarias toman decisiones sobre la vacunación pensando en el bienestar de la población.

```{r confianza_autoridades_sanitarias, echo=FALSE, fig.align='center', warning=FALSE, fig.width=6, fig.height=5, message = FALSE  }

# Confianza en las autoridades sanitarias
confianza_autoridades_sanitarias <- 
movid_2022_s |> 
  filter(!d12_2_recoded == "NS/NR") |> 
  group_by(d12_2_recoded) |> 
  summarize(proportion = survey_mean(vartype = "ci"))

graph_barras_univariado(confianza_autoridades_sanitarias,
                        titulo = "Confianza autoridades sanitarias año 2022",
                       subtitulo = "Confío en que las autoridades sanitarias toman decisiones \n sobre la vacunación pensando en el bienestar de la población",
                       ancho_texto_x = 10)

```

##### Importancia  de la vacunación

Se solicitó a las personas que evaluaran su nivel de acuerdo con la afirmación: "No es necesario vacunarse dado que la enfermedad por coronavirus ya no es tan grave". De acuerdo con los resultados de la encuesta, un 17.4% (IC95% 14.8-20.0) de las personas manifestó estar de acuerdo o muy de acuerdo con esta afirmación. Esto implica que consideran que, hasta junio de 2022, la enfermedad ya no sería tan grave y, por lo tanto, no sería necesario vacunarse.

Esta opinión podría estar relacionada con los cambios en el escenario epidemiológico del país, como la predominancia de cepas distintas a la originada en Wuhan al inicio de la pandemia. También podría estar influenciada por la llamada fatiga pandémica o un cambio en la comunicación de los medios de comunicación tras dos años de pandemia, entre otras razones.

Por otro lado, un 77.4% (IC95% 74.9-80.7) de las personas estaría en desacuerdo o muy en desacuerdo con esta afirmación. Esto significa que consideran que la infección por COVID-19 sigue siendo grave y es importante vacunarse. Este porcentaje se mantiene similar al de las preguntas anteriores, lo que permite afirmar que alrededor del 80% de la población confía en las vacunas, en las autoridades sanitarias y considera que es necesario vacunarse.


```{r importancia_vacunacion, echo=FALSE, fig.align='center', warning=FALSE, fig.width=6, fig.height=5, message = FALSE  }

# Importancia de la vacunación
importancia_vacunacion <- 
movid_2022_s |> 
  filter(!d12_3_recoded == "NS/NR") |> 
  group_by(d12_3_recoded) |> 
  summarize(proportion = survey_mean(vartype = "ci"))

graph_barras_univariado(importancia_vacunacion,
                        titulo = "Persepción del riesgo COVID-19 y vacunación año 2022",
                       subtitulo = "No es necesario vacunarse dado que la enfermedad \n por coronavirus ya no es tan grave",
                       ancho_texto_x = 10)

```

En términos generales, al desagregar esta pregunta por tramo etario y sexo no se observan  mayores diferencias. 

```{r importancia_vacunacion_edad, echo=FALSE, fig.align='center', warning=FALSE, fig.width=6, fig.height=5, message = FALSE  }

# Importancia de la vacunación según tramo etario
importancia_vacunacion_edad <- 
movid_2022_s |> 
  filter(!d12_3_recoded == "NS/NR") |> 
  group_by(edad_2, d12_3_recoded) |> 
  summarize(proportion = survey_mean(vartype = "ci"))

graph_barras_bivariado(importancia_vacunacion_edad,
                       titulo = "Persepción del riesgo COVID-19 y vacunación año 2022",
                       subtitulo = "No es necesario vacunarse dado que la enfermedad \n por coronavirus ya no es tan grave, según tramo etario",
                       ancho_texto_x = 10)

```


```{r importancia_vacunacion_sexo, echo=FALSE, fig.align='center', warning=FALSE, fig.width=6, fig.height=5, message = FALSE  }

# Importancia de la vacunación según tramo etario
importancia_vacunacion_sexo <-
movid_2022_s |> 
  filter(!d12_3_recoded == "NS/NR") |> 
  group_by(sexo, d12_3_recoded) |> 
  summarize(proportion = survey_mean(vartype = "ci")) |> 
  mutate(sexo = recode(as.factor(sexo), '1' = "Hombre", '2' = "Mujer"))

graph_barras_bivariado(importancia_vacunacion_sexo,
                       titulo = "Persepción del riesgo COVID-19 y vacunación año 2022",
                       subtitulo = "No es necesario vacunarse dado que la enfermedad \n por coronavirus ya no es tan grave, según sexo",
                       ancho_texto_x = 10)

```

Asimismo, se exploró si podía haber alguna diferencia según el medio de comunicación principal que las personas utilizan para informarse. Sin embargo, al desagregar los datos por esta variable, no se encontraron diferencias significativas. Esto indica que, independientemente del medio de comunicación que las personas utilicen para informarse, no se observaron variaciones significativas en las opiniones y actitudes relacionadas con la vacunación contra el COVID-19.

```{r importancia_vacunacion_medios, echo=FALSE, fig.align='center', warning=FALSE, fig.width=6, fig.height=5, message = FALSE  }

# Importancia de la vacunación según medios de información
importancia_vacunacion_medios <- 
movid_2022_s |> 
  filter(!d12_3_recoded %in% c("NS/NR","Indiferente"), !mi_web_o_tradicionales == "Otros/NS/NR") |> 
  group_by(mi_web_o_tradicionales, d12_3_recoded) |> 
  summarize(proportion = survey_mean(vartype = "ci"))

graph_barras_bivariado(importancia_vacunacion_medios,
                       titulo = "Persepción del riesgo COVID-19 y vacunación año 2022",
                       subtitulo = "No es necesario vacunarse dado que la enfermedad \n por coronavirus ya no es tan grave, según principal medio de información",
                       ancho_texto_x = 10)

```


#### Disposición a vacunación anual

Por último, se consultó a las personas por su disposición a vacunarse anualmente. Al respecto, un 15.8% (IC95% 13.3-18.4) estaría poco o nada dispuesto a vacunarse, sin identificarse mayores diferencias por sexo. 

```{r disposicion_vacunacion_anual_sexo, echo=FALSE, fig.align='center', warning=FALSE, fig.width=6, fig.height=5, message = FALSE  }
# General 

disposicion_vacunacion_anual <- 
  movid_2022_s |> 
  filter(!d13_recoded == "NS/NR") |> 
  group_by(d13_recoded) |> 
  summarize(proportion = survey_mean(vartype = "ci")) 

# Por sexo
disposicion_vacunacion_anual_sexo <- 
movid_2022_s |> 
  filter(!d13_recoded == "NS/NR") |> 
  group_by(sexo, d13_recoded) |> 
  summarize(proportion = survey_mean(vartype = "ci")) |> 
  mutate(sexo = recode(as.factor(sexo), '1' = "Hombre", '2' = "Mujer"))

graph_barras_bivariado(disposicion_vacunacion_anual_sexo,
                       titulo = "Disposición a vacunarse anualmente, año 2022")

```

Sin embargo, si se evidencian diferencias según tramo etario. Mientras que entre los adultos de 60 años o más solamente un 9.1% (IC95% 6.2-12.0) estaría poco o nada dispuesto a vacunarse anualmente contra el Covid-19, esta cifra se eleva a un 21.0% (IC95% 13.7-28.3)  en el caso de los adultos entre 18 y 29 años.

```{r disposicion_vacunacion_anual_edad, echo=FALSE, fig.align='center', warning=FALSE, fig.width=6, fig.height=5, message = FALSE  }

# Por edad
disposicion_vacunacion_anual_edad <- 
movid_2022_s |> 
  filter(!d13_recoded == "NS/NR") |> 
  group_by(edad_2, d13_recoded) |> 
  summarize(proportion = survey_mean(vartype = "ci"))

graph_barras_bivariado(disposicion_vacunacion_anual_edad,
                       titulo = "Disposición a vacunarse anualmente, año 2022")

```

### 5. Disposición vacunal en niños (desde los 6 meses considerando grupos de edad y diferentes vacunas) 

En cuanto a la disposición vacunal en niños, en la versión de la encuesta del año 2022 se consultó a las personas sobre su grado de acuerdo con la vacunación anual de niños y niñas de 3 años o más contra el COVID-19, utilizando vacunas aprobadas por las autoridades sanitarias. Frente a esta pregunta, el 66.8% (IC95% 63.4-70.3) de las personas manifestó estar de acuerdo o muy de acuerdo, mientras que un 20.5% (IC95% 17.6-23.3) indicó estar en desacuerdo o muy en desacuerdo.

Estos resultados muestran que la mayoría de las personas encuestadas estaría de acuerdo con la vacunación anual de niños y niñas de 3 años o más contra el COVID-19, utilizando vacunas aprobadas por las autoridades sanitarias. Sin embargo, es importante tener en cuenta que un porcentaje significativo de personas aún muestra alguna forma de desacuerdo con esta afirmación.

```{r vacunacion_ninos, echo=FALSE, fig.align='center', warning=FALSE, fig.width=6, fig.height=5, message = FALSE  }

# Importancia de la vacunación en ninos 
vacunacion_ninos <- 
movid_2022_s |> 
  filter(!d14_recoded %in% c("NS/NR")) |> 
  group_by( d14_recoded) |> 
  summarize(proportion = survey_mean(vartype = "ci"))


graph_barras_univariado(vacunacion_ninos,
                       titulo = "Disposición vacunal en niños, año 2022",
                       subtitulo = "Disposición a vacunar anualmente a niños de 3 años o más",
                       ancho_texto_x = 10)

```

Al desagregar por sexo no se obtuvieron diferencias significativas (se excluyó categoría neutra "ni de acuerdo ni en desacuerdo").

```{r vacunacion_ninos_sexo, echo=FALSE, fig.align='center', warning=FALSE, fig.width=6, fig.height=5, message = FALSE  }

# Importancia de la vacunación en ninos según sexo (se filtran neutrales)
vacunacion_ninos_sexo <- 
movid_2022_s |> 
  filter(!d14_recoded %in% c("NS/NR","Indiferente") ) |> 
  group_by(sexo, d14_recoded) |> 
  summarize(proportion = survey_mean(vartype = "ci")) |> 
  mutate(sexo = recode(as.factor(sexo), '1' = "Hombre", '2' = "Mujer"))

graph_barras_bivariado(vacunacion_ninos_sexo,
                       titulo = "Disposición vacunal en niños, año 2022",
                       subtitulo = "Disposición a vacunar anualmente a niños de 3 años o más, según sexo del adulto",
                       ancho_texto_x = 10)

```

Al desagregar los datos por tramo etario, se observa una mayor disposición a vacunar anualmente a los niños en los adultos de 60 años o más en comparación con los adultos de entre 18 y 29 años. Esta tendencia es similar a la que se observa en el caso de la vacunación anual en adultos, donde los adultos de mayor edad muestran una mayor disposición a vacunarse anualmente.

Estos resultados sugieren que existe una diferencia generacional en cuanto a la disposición a vacunar anualmente a los niños contra el COVID-19. Los adultos de mayor edad parecen mostrar una mayor aceptación y confianza en la vacunación anual, mientras que los adultos más jóvenes pueden tener una disposición ligeramente menor en comparación.

```{r vacunacion_ninos_edad, echo=FALSE, fig.align='center', warning=FALSE, fig.width=6, fig.height=5, message = FALSE  }

# Importancia de la vacunación en ninos según edad (se filtran neutrales)
vacunacion_ninos_edad <- 
movid_2022_s |> 
  filter(!d14_recoded %in% c("NS/NR","Indiferente"),  ) |> 
  group_by(edad_2, d14_recoded) |> 
  summarize(proportion = survey_mean(vartype = "ci")) 

graph_barras_bivariado(vacunacion_ninos_edad,
                       titulo = "Disposición vacunal en niños, año 2022",
                       subtitulo = "Disposición a vacunar anualmente a niños de 3 años o más, \n según tramo etario del adulto",
                       ancho_texto_x = 10)

```

Al desagregar por el principal medio de información utilizado tampoco se observan diferencias concluyentes. En este sentido, no hay evidencia que los medios de comunicación tengan algún efecto en la opinión de las personas sobre la vacunación en niños. 

```{r vacunacion_ninos_medios, echo=FALSE, fig.align='center', warning=FALSE, fig.width=6, fig.height=5, message = FALSE  }

# Importancia de la vacunación en ninos según medios de información (se filtran neutrales)
vacunacion_ninos_medios <- 
movid_2022_s |> 
  filter(!d14_recoded %in% c("NS/NR","Indiferente"), !mi_web_o_tradicionales == "Otros/NS/NR") |> 
  group_by(mi_web_o_tradicionales, d14_recoded) |> 
  summarize(proportion = survey_mean(vartype = "ci"))

graph_barras_bivariado(vacunacion_ninos_medios,
                       titulo = "Disposición vacunal en niños, año 2022",
                       subtitulo = "Disposición a vacunar anualmente a niños de 3 años o más, \n según principal medio de información",
                       ancho_texto_x = 10)

```

#### Disposición vacunal en niños y adultos

Al cruzar las preguntas sobre la disposición vacunal en niños y adultos, se puede observar que entre las personas que están muy o bastante dispuestas a vacunarse anualmente, un 85.7% (IC95% 82.7-88.7) estaría de acuerdo o muy de acuerdo con la vacunación de niños y niñas de 3 años o más. Del mismo modo, entre las personas que tienen poca o ninguna disposición a vacunarse anualmente, un 77.6% (IC95% 69.6-85.6) estaría en desacuerdo o muy en desacuerdo con la vacunación de niños y niñas de 3 años o más. Como era de esperar, estas opiniones estarían altamente correlacionadas.

Sin embargo, es importante destacar que existe un grupo de personas que están dispuestas o muy dispuestas a vacunarse anualmente pero que estarían en desacuerdo con que los niños mayores de 3 años lo hagan. Este grupo representa aproximadamente el 6.2% (IC95% 4.2-8.3) de la población que está dispuesta o muy dispuesta a vacunarse anualmente.

Estos resultados revelan diferentes perspectivas y opiniones en relación con la vacunación anual en niños y adultos, incluso dentro del grupo de personas dispuestas a vacunarse anualmente. Es importante considerar estas diferencias y explorar las razones detrás de estas discrepancias para abordar de manera adecuada las inquietudes y promover la vacunación en la población en general.

```{r disposicion_vacunacion_ninos_adultos, echo=FALSE, fig.align='center', warning=FALSE, fig.width=6, fig.height=5, message = FALSE  }

## Disposición vacunal en niños y adultos 
# Se exckuye kla categiría algo dispuesto (neutra) en d13 para simplificar el gráfico. 
disposicion_vacunacion_ninos_adultos <- 
  movid_2022_s |> 
  filter(!d13_recoded %in% c("NS/NR", "Algo dispuesto"), !d14_recoded %in% c("NS/NR")) |> 
  group_by(d13_recoded, d14_recoded) |> 
  summarize(proportion = survey_mean(vartype = "ci")) |> 
  mutate(d13_recoded = recode(d13_recoded,
                              "Muy o bastante dispuesto" = "Adultos dispuestos a vacunarse",
                              "Poco o nada dispuesto" = "Adultos poco o nada dispuestos a vacunarse"))

graph_barras_bivariado(disposicion_vacunacion_ninos_adultos,
                       titulo = "Disposición vacunal en niños, año 2022",
                       subtitulo = "Disposición a vacunar anualmente a niños de 3 años o más (d14), \n según disposición a vacunarse anualmente(d13)",
                       ancho_texto_x = 20)

```



### 6. Medidas de autocuidado y protección ante sospecha de COVID-19

Para evaluar las medidas de autocuidado y protección adoptadas por las personas en caso de sospecha de COVID-19, se realizaron dos preguntas en la versión de la encuesta del año 2022. En la pregunta C7 se consultó a las personas qué harían durante los siguientes siete días si estuvieran en contacto estrecho con una persona con COVID-19 pero no presentaran síntomas compatibles con la enfermedad. En la pregunta C8, se les preguntó qué harían durante los siguientes siete días si comenzaran a tener síntomas compatibles con la enfermedad después de tener ese contacto estrecho.

Las respuestas a estas preguntas se clasificaron en diferentes acciones preventivas, como el aislamiento, el uso de mascarilla en lugares cerrados, la realización de pruebas rápidas o PCR, entre otras. Se construyó un índice que varía de 0 a 3, donde 0 indica que no se realiza ninguna acción y 3 implica realizar todas las acciones mencionadas anteriormente. Los valores intermedios representan la sumatoria de las acciones realizadas.

Al comparar ambas preguntas, se observa que las personas tienden a tomar más medidas preventivas si presentan síntomas en comparación con el caso en que no los tienen. Por ejemplo, en el caso de tener contacto estrecho con una persona con COVID-19 pero sin síntomas, un 8.6% (IC95% 6.7-10.5) de las personas no realizaría ninguna de las acciones preventivas mencionadas anteriormente. Sin embargo, en el caso de presentar síntomas, esta cifra se reduce al 2.4% (IC95% 1.3-3.7).

Además, se observa un aumento significativo en el número de personas que llevarían a cabo al menos dos acciones preventivas si tuvieran síntomas asociados con COVID-19 y fueran contacto estrecho. Por ejemplo, este porcentaje aumenta del 32.0% (IC95% 28.7-35.3) cuando no se presentan síntomas al 51.7% (IC95% 48.2-55.3) cuando sí se presentan síntomas.

Estos resultados indican que las personas tienden a adoptar más medidas preventivas cuando experimentan síntomas relacionados con la enfermedad o son contacto estrecho con una persona con COVID-19 y presentan síntomas. Esto sugiere una mayor conciencia y sensibilización sobre la necesidad de tomar precauciones en caso de sospecha de COVID-19.

```{r indice_respuesta_contacto_estrecho_comparacion, echo=FALSE, fig.align='center', warning=FALSE, fig.width=6, fig.height=5, message = FALSE  }


## Indice de acciones realizadas si la persona es contacto estrecho
# Donde  se evaluan tres acciones (se aislaría, utilizaría mascarilla al interior del hogar o 
# en lugares cerrados y se  realizaría un test rapido o examen pcr). El número indica cuantas de dichas 
# acciones realizaría la persona. 


indice_respuesta_contacto_estrecho_sin_sintomas <- 
  movid_2022_s |> 
  filter() |> 
  group_by(as.factor(indice_respuesta_contacto_estrecho_sin_sintomas)) |> 
  summarize(proportion = survey_mean(vartype = "ci")) |> 
  mutate(sintomas = "No presenta sintomas después del contacto") |> 
  select(sintomas, indice_respuesta_contacto_estrecho =`as.factor(indice_respuesta_contacto_estrecho_sin_sintomas)`, everything())

indice_respuesta_contacto_estrecho_con_sintomas <- 
  movid_2022_s |> 
  filter() |> 
  group_by(as.factor(indice_respuesta_contacto_estrecho_con_sintomas)) |> 
  summarize(proportion = survey_mean(vartype = "ci")) |> 
  mutate(sintomas = "Presenta sintomas después del contacto") |> 
  select(sintomas, indice_respuesta_contacto_estrecho = `as.factor(indice_respuesta_contacto_estrecho_con_sintomas)`, everything())


indice_respuesta_contacto_estrecho_comparacion <- rbind(indice_respuesta_contacto_estrecho_sin_sintomas, 
                                                        indice_respuesta_contacto_estrecho_con_sintomas)

# Orden de la variable para gráfico
indice_respuesta_contacto_estrecho_comparacion$sintomas <- 
  factor(indice_respuesta_contacto_estrecho_comparacion$sintomas,
         levels = c("No presenta sintomas después del contacto", "Presenta sintomas después del contacto"))

graph_barras_bivariado(indice_respuesta_contacto_estrecho_comparacion,
                       titulo = "Reacción a contacto estrecho, año 2022",
                       subtitulo = "Nº acciones realizadas en caso de contacto estrecho",
                       ancho_texto_x = 20)

```

Al analizar con mayor detalle las acciones que las personas mencionan o no mencionan espontáneamente al ser contacto estrecho y presentar síntomas, se observa que la principal medida que no es mencionada es el uso de mascarilla en lugares cerrados. Solo un 7.2% (IC95% 5.2-9.1) de la población incluye esta acción en sus respuestas.

Estos resultados sugieren que, a pesar de la importancia del uso de mascarillas en lugares cerrados para prevenir la propagación del virus, existe una proporción significativa de personas que no considera esta medida como parte de sus acciones preventivas en caso de ser contacto estrecho y presentar síntomas. 

```{r comparacion_acciones_contacto_estrecho_con_sintomas, echo=FALSE, fig.align='center', warning=FALSE, fig.width=6, fig.height=5, message = FALSE  }

# Se observa que la mayoría de la población realizaría entre 1 y 2 acciones. 
# la principal medida que la gente no realizaría es: 
# Utilizar mascarilla en lugares cerrados , donde tan solo un 6.90% (IC95% 5.03% - 8.77%) 
# de la muestra declaró que lo haría

# mascarilla
utilizar_mascarilla_contacto_estrecho_con_sintomas <- 
movid_2022_s |> 
  filter() |> 
  group_by(as.factor(c8_3)) |> 
  summarize(proportion = survey_mean(vartype = "ci")) |> 
  mutate(accion = "Utilizar mascarilla en lugares cerrados") |> 
  select(accion, si_no = `as.factor(c8_3)`, everything()) |> 
  mutate(si_no = recode(si_no, `0` = "No se menciona espontaneamente", `1` = "Se menciona espontaneamente"))

# Aislamiento
aislamiento_contacto_estrecho_con_sintomas <- 
  movid_2022_s |> 
  filter() |> 
  group_by(as.factor(c8_2)) |> 
  summarize(proportion = survey_mean(vartype = "ci")) |> 
  mutate(accion = "Aislamiento") |> 
  select(accion, si_no = `as.factor(c8_2)`, everything()) |> 
  mutate(si_no = recode(si_no, `0` = "No se menciona espontaneamente", `1` = "Se menciona espontaneamente"))

# Realización test
test_contacto_estrecho_con_sintomas <- 
  movid_2022_s |> 
  filter() |> 
  group_by(as.factor(c8_realizar_test)) |> 
  summarize(proportion = survey_mean(vartype = "ci")) |> 
  mutate(accion = "Realizar test COVID") |> 
  select(accion, si_no = `as.factor(c8_realizar_test)`, everything()) |> 
  mutate(si_no = recode(si_no, `0` = "No se menciona espontaneamente", `1` = "Se menciona espontaneamente"))



# Comparacion

comparacion_acciones_contacto_estrecho_con_sintomas <- rbind(utilizar_mascarilla_contacto_estrecho_con_sintomas,
                                                             aislamiento_contacto_estrecho_con_sintomas,
                                                             test_contacto_estrecho_con_sintomas)

graph_barras_bivariado(comparacion_acciones_contacto_estrecho_con_sintomas,
                       titulo = "Reacción a contacto estrecho, año 2022",
                       subtitulo = "Acciones a realizar en caso de contacto estrecho y presentar sintomas",
                       ancho_texto_x = 15)

```

Por último, al analizar las diferencias según el principal medio de comunicación utilizado por las personas para informarse, se observa una diferencia significativa en cuanto a las acciones preventivas que realizarían en caso de ser contacto estrecho y presentar síntomas.

En particular, se observa que un mayor porcentaje de personas que se informan principalmente por internet mencionan que realizarían dos acciones preventivas en lugar de una, en comparación con aquellas personas que se informan principalmente por medios tradicionales. Específicamente, el 57.3% (IC95% 52.6-62.0) de las personas que se informan por internet mencionan que llevarían a cabo dos acciones preventivas, mientras que solo el 37.6% (IC95% 30.0-45.3) de las personas que se informan por medios tradicionales mencionan lo mismo. 

Estos resultados sugieren que las personas que se informan a través de internet podrían estar más expuestas a una mayor cantidad de información actualizada sobre las medidas preventivas y recomendaciones sanitarias, lo que puede influir en su disposición a adoptar múltiples acciones preventivas en caso de ser contacto estrecho y presentar síntomas. No obstante, esta es una hipótesis que habría que revisar con más profundidad, entendiendo que esta varíable puede estar enmascarando una subpoblación específica (por ejemplo, cabría preguntarse ¿quiénes son los que principalmente se informan a través de internet?)

```{r comparacion_acciones_contacto_estrecho_con_sintomas_desagregaciones, echo=FALSE, fig.align='center', warning=FALSE, fig.width=6, fig.height=5, message = FALSE  }
## Desagregaciones 

# Medidas de autocuidado y proteccion antes sospecha covid según medios de información 
indice_respuesta_contacto_estrecho_con_sintomas_medios <- 
  movid_2022_s |> 
  filter(!mi_web_o_tradicionales == "Otros/NS/NR") |> 
  group_by(mi_web_o_tradicionales, as.factor(indice_respuesta_contacto_estrecho_con_sintomas)) |> 
  summarize(proportion = survey_mean(vartype = "ci"))

# Medidas de autocuidado y proteccion antes sospecha covid según edad 
indice_respuesta_contacto_estrecho_con_sintomas_edad <- 
  movid_2022_s |> 
  filter() |> 
  group_by(edad_2, as.factor(indice_respuesta_contacto_estrecho_con_sintomas)) |> 
  summarize(proportion = survey_mean(vartype = "ci"))

# Medidas de autocuidado y proteccion antes sospecha covid según sexo
indice_respuesta_contacto_estrecho_con_sintomas_sexo <- 
  movid_2022_s |> 
  filter() |> 
  group_by(sexo, as.factor(indice_respuesta_contacto_estrecho_con_sintomas)) |> 
  summarize(proportion = survey_mean(vartype = "ci"))

# Medidas de autocuidado y proteccion antes sospecha covid según si la persona es enferma crónica 
indice_respuesta_contacto_estrecho_con_sintomas_cronica <- 
  movid_2022_s |> 
  filter() |> 
  group_by(cronica_d, as.factor(indice_respuesta_contacto_estrecho_con_sintomas)) |> 
  summarize(proportion = survey_mean(vartype = "ci"))

graph_barras_bivariado(indice_respuesta_contacto_estrecho_con_sintomas_medios,
                       titulo = "Reacción a contacto estrecho, año 2022",
                       subtitulo = "Nº acciones realizadas en caso de contacto estrecho según medio de información",
                       ancho_texto_x = 15)


```



### 7. Aceptabilidad de estrategias para aumentar tasa de vacunación ante COVID-19 (percepción que tengan las personas de estas estrategias)

En cuanto a la aceptabilidad de estrategias para aumentar la tasa de vacunación contra COVID-19, no se dispone de preguntas específicas que evalúen directamente la efectividad de distintas estrategias. Sin embargo, en la segunda versión del cuestionario de la encuesta (2022), se incluyó una pregunta que indaga sobre la percepción de las personas respecto a si consideran que obtener el pase de movilidad es una motivación importante para que las personas se vacunen.

En relación a esta pregunta, se observa que el 80% (IC95% 77.1-83.0) de las personas estaría de acuerdo o muy de acuerdo con la afirmación de que el pase de movilidad es una motivación importante para que las personas se vacunen. Por otro lado, un 13.8% (IC95% 11.2-16.3) de las personas estaría en desacuerdo o muy en desacuerdo con esta afirmación.

Estos resultados sugieren que la mayoría de las personas considera que el pase de movilidad es una medida motivadora para incentivar la vacunación contra el COVID-19. Sin embargo, es importante tener en cuenta que este resultado se refiere a una única estrategia y no abarca la evaluación de otras posibles medidas para aumentar la tasa de vacunación.

```{r motivacion_pase, echo=FALSE, fig.align='center', warning=FALSE, fig.width=6, fig.height=5, message = FALSE  }
## Desagregaciones 

## d12.9 Considera que el pase de movilidad es una motivación importante para que las personas se vacunen?

motivacion_pase <- 
  movid_2022_s |> 
  filter(!d12_9_recoded == "NS/NR") |> 
  group_by(d12_9_recoded) |> 
  summarize(proportion = survey_mean(vartype = "ci"))

graph_barras_univariado(motivacion_pase,
                       titulo = "Aprobación pase de movilidad, año 2022",
                       subtitulo = "Obtener el Pase de Movilidad es una motivación importante para que \n  las personas se vacunen",
                       ancho_texto_x = 15)

```

Al desagregar por sexo y principal medio de información no se encontraron diferencias respectoa  esta variable. 

Si se encontraron diferencias al desagregar los resultados por tramo etario, donde se observa una diferencia significativa en la aceptabilidad de la estrategia del pase de movilidad para aumentar la tasa de vacunación entre las personas de diferentes grupos de edad.

Específicamente, se observa que entre las personas de 60 años o más, solo un grupo cercano al 8.0% (IC95% 5.1-10.8) estaría en desacuerdo o muy en desacuerdo con la afirmación de que el pase de movilidad es una motivación importante para que las personas se vacunen. En contraste, entre las personas de 30 a 59 años, un 17.1% (IC95% 13.5-20.8) estaría en desacuerdo o muy en desacuerdo con esta afirmación.

Estos resultados sugieren que las personas de 60 años o más muestran una mayor disposición a acatar las normas y recomendaciones de las autoridades sanitarias, incluso si no están totalmente de acuerdo con ellas, en comparación con el grupo de edad de 30 a 59 años. Esta diferencia puede reflejar una mayor conciencia y percepción del riesgo por parte de las personas mayores, así como una mayor confianza en las medidas implementadas por las autoridades para controlar la propagación del virus.

Es importante tener en cuenta que estas diferencias se refieren específicamente a la aceptabilidad de la estrategia del pase de movilidad y no necesariamente se extienden a otras medidas o estrategias para aumentar la tasa de vacunación contra el COVID-19.

```{r motivacion_pase_edad, echo=FALSE, fig.align='center', warning=FALSE, fig.width=6, fig.height=5, message = FALSE  }
## Desagregaciones 

# Desagergada por sexo
motivacion_pase_sexo <-
movid_2022_s |> 
  filter(!d12_9_recoded == "NS/NR") |> 
  group_by(sexo, d12_9_recoded) |> 
  summarize(proportion = survey_mean(vartype = "ci"))

# Desagregada por medios de informacion
motivacion_pase_medios <-
movid_2022_s |> 
  filter(!d12_9_recoded == "NS/NR", !mi_web_o_tradicionales == "Otros/NS/NR") |> 
  group_by(mi_web_o_tradicionales, d12_9_recoded) |> 
  summarize(proportion = survey_mean(vartype = "ci"))

# Desagregada por tramo etario
motivacion_pase_edad <-
movid_2022_s |> 
  filter(!d12_9_recoded == "NS/NR") |> 
  group_by(edad_2, d12_9_recoded) |> 
  summarize(proportion = survey_mean(vartype = "ci"))

graph_barras_bivariado(motivacion_pase_edad,
                       titulo = "Aprobación pase de movilidad, año 2022",
                       subtitulo = "Obtener el Pase de Movilidad es una motivación importante para que \n  las personas se vacunen, según tramo etario",
                       ancho_texto_x = 15)

```

Adicionalmente, en ambas versiones del cuestionario se evaluó el nivel de seguimiento de normas  de las autoridades sanitarias por parte de las personas, (preguntas e1.4 en versión 2022 y f3.3 en versión 2020) pidiendo dar su nivel de acuerdo con la siguiente afirmación: *"Aunque a veces no estemos de acuerdo con las autoridades sanitarias y las medidas que se proponen, es nuestro deber seguir sus indicaciones al pie de la letra"*. En este sentido, puede esperarse que aquellas personas con un bajo nivel de aceptación de normas estarían encontrarían contrarías a aceptar estrategias para aumentar la tasa de vacunación, a la vez que serían el grupo objetivo de estas estrategias. 

Como se observa en el siguiente gráfico, no hay mayores diferencias al comparar ambos años, tanto en el año 2020 como en 2022 más del 80% de la población esta de acuerdo  o muy de acuerdo con que se deben seguir las indicaciones de las autoridades sanitarias. 

```{r acata_normas_comparacion_anos, echo=FALSE, fig.align='center', warning=FALSE, fig.width=6, fig.height=5, message = FALSE  }
## Acatación normas  autoridades sanitarias, comparacion año 2020 (f3_3) y 2022 (e1_4)

#Año 2020
acata_normas_2020 <- 
movid_2020_s |> 
  filter(!f3_3_recoded == "NS/NR") |> 
  group_by(f3_3_recoded) |> 
  summarize(proportion = survey_mean(vartype = "ci")) |> 
  mutate(ano = "2020") |> 
  select(ano, valoracion = f3_3_recoded,  everything())
# Año 2022
acata_normas_2022 <- 
movid_2022_s |> 
  filter(!e1_4_recoded == "NS/NR") |> 
  group_by(e1_4_recoded) |> 
  summarize(proportion = survey_mean(vartype = "ci")) |> 
  mutate(ano = "2022") |> 
  select(ano, valoracion = e1_4_recoded,  everything())

# Tabulado con comparacion de los anos

acata_normas_comparacion_anos <- rbind(acata_normas_2020, acata_normas_2022)

graph_barras_bivariado(motivacion_pase_edad,
                       titulo = "Acata normas autoridades sanitarias, año 2022",
                       subtitulo = "Aunque a veces no estemos de acuerdo con las autoridades sanitarias y \n las medidas que se proponen, es nuestro deber seguir sus indicaciones \n al pie de la letra",
                       ancho_texto_x = 15)

```

Al comparar la aprobación del gobierno respecto a las medidas para combatir la pandemia, se observa un aumento significativo en la aprobación relacionada con la campaña de vacunación contra el COVID-19 y el relajamiento de las restricciones a la movilización de las personas, condicionada al pase de movilidad y la fase epidemiológica de los territorios.

En el año 2020, el 41.7% (IC95% 38.3-45.2) de las personas estaba de acuerdo o muy de acuerdo con la afirmación de que las medidas adoptadas por el gobierno para proteger a la población del coronavirus habían sido las adecuadas. Sin embargo, en el año 2022, esta cifra aumentó significativamente a un 60.1% (IC95% 56.5-63.6).

Este aumento en la aprobación del gobierno puede atribuirse en gran medida al despliegue exitoso de la campaña de vacunación contra el COVID-19 y al impacto positivo que ha tenido en la reducción de casos, hospitalizaciones y muertes relacionadas con la enfermedad. Asimismo, el relajamiento de las restricciones de movilidad, condicionado al pase de movilidad y la situación epidemiológica de los territorios, podría haber generadouna percepción de mayor control sobre la propagación del virus y menos estres sobre las personas. 

```{r aprobacion_gobierno_comparacion_anos, echo=FALSE, fig.align='center', warning=FALSE, fig.width=6, fig.height=5, message = FALSE  }
## Aprobación del gobierno y sus medidas sanitarias, comparacion año 2020 (f3_4) y 2022 (e1_5)

#Año 2020
aprobacion_gobierno_2020 <- 
  movid_2020_s |> 
  filter(!f3_4_recoded == "NS/NR") |> 
  group_by(f3_4_recoded) |> 
  summarize(proportion = survey_mean(vartype = "ci")) |> 
  mutate(ano = "2020") |> 
  select(ano, valoracion = f3_4_recoded,  everything())
# Año 2022
aprobacion_gobierno_2022 <- 
  movid_2022_s |> 
  filter(!e1_5_recoded == "NS/NR") |> 
  group_by(e1_5_recoded) |> 
  summarize(proportion = survey_mean(vartype = "ci")) |> 
  mutate(ano = "2022") |> 
  select(ano, valoracion = e1_5_recoded,  everything())

# Tabulado con comparacion de los anos

aprobacion_gobierno_comparacion_anos <- rbind(aprobacion_gobierno_2020, aprobacion_gobierno_2022)

graph_barras_bivariado(aprobacion_gobierno_comparacion_anos,
                       titulo = "Aprobación del gobierno, comparación años",
                       subtitulo = "Las medidas que el gobierno actual está adoptando para proteger a la población \n  del coronavirus han sido las adecuadas",
                       ancho_texto_x = 15)
```

### 8. Aceptabilidad inmunizaciones en general post COVID-19 (reticencia vacunal) 

En los puntos 4 y 5 ya se entregaron distintos antecedentes y análisis respecto a la disposición vaucnal de las personas respecto al coronavirus. No obstante, queda abierta la pregunta si  es que este rechazo por parte de la población a las vacunas contra el covid-19 se extiende a las vacunas en general. 

Frente a esta  problemática, primero hay que advertir que en esta encuesta se pregunto por la disposición de las personas a vacunarse anualmente contra el COVID-19, y que, una persona podría estar en contra de la idea de vacunarse anualmente pero  no necesariamente estar contra las vacunas. De la misma forma, como ya se analizó en el capítulo 4, existen distintas razones por las que se rechaza la vacunación anual contra el COVID-19, de las cuales solamente una implica un rechazo categórico a las vacunas en general.

Habiendo hecho las aclaraciones anteriores, con los resutlados de la encuesta en el año 2022 es posible identificar  a aquella subpoblación que rechaza las inmunizacioens en general (se le denominará "antivacunas"), reconociendo a aquellas personas que no completaron su esquema de vacunación ni lo harían proximanete y declararon estar en contra de las vacunas en general cuando se les consulto por la razón de aquella decisión (pregunta d8). 

Por lo tanto,  solo se hizo esta pregunta a un subconjunto de la muestra: quienes no completaron su esquema de vacunación ni lo harían en las próximas dos semanas.  Este subconjunto correspondería a 99 personas del total encuestado (1267 personas). De este grupo, solo 13 personas en toda la muestra respondieron que rechazan las inmunizaciones en general. 

Al estimar su peso poblacional, se estima que alrededor del 1.0% (IC95% 0.3-1.7) de los mayores de 18 años podrían clasificarse como personas antivacunas o que están en contra de las inmunizaciones en general. 

```{r antivacunas, echo=FALSE, fig.align='center', warning=FALSE, fig.width=6, fig.height=5, message = FALSE  }
## d8.h Personas que estan en contra las vacunas en general. 

# Recordar que esta pregunta solo se hizo a personas que no tienen su esquema de vacunación completo 
# y  que  es poco o nada probable que se vacunen en las próximas dos semanas 

# Muestra
muestra_antivacuna <- 
movid_2022 |> 
  filter() |> 
  group_by(d8_h) |> 
  tally()

#Estimacion poblacional
poblacion_antivacunas <- 
movid_2022_s |> 
  filter() |> 
  group_by(d8_h) |> 
  summarize(proportion = survey_mean(vartype = "ci"))

# Ahora bien, se puede identificar a este grupo de "anti-vacunas" como aquellos que
# 1. no se han vacunado contra el coronavirus y 2. manifestan estar en contra de las vacunas en general. 

# En base a los resultados, se observa que alrededor del 1% (IC95% 0.27% - 1.74%)  de la población objetivo de la encuesta  
# estaría encontra de las vacunas en general (antivacunas)
antivacunas <- 
movid_2022_s |> 
  filter() |> 
  group_by(antivacunas) |> 
  summarize(proportion = survey_mean(vartype = "ci"))


graph_barras_univariado(antivacunas,
                       titulo = "Porcentaje población 'antivacunas', año 2022 ",
                       subtitulo = "Porcentaje población que acepta o rechaza inmunizaciones en general",
                       ancho_texto_x = 15)
```

Dado que este grupo corresponde a un grupo pequeño, tanto muestral como poblacionalmente, lo más apropiado es caracterizarlos sin expandir los datos poblacionalmente. Al caracterizar a este grupo se observa que son personas de ambos sexos, principalmente de 30 a 59 años, cuyo principal medio de información son tradicionales o internet (pero no ambos), la mayoría cree en la medicina alternativa y cree que la pandemia del COVID19 fue creada intencionalmente, con fines políticos y ecónomicos (visión conspiracionista de la pandemia).

```{r muestra_antivacunas_sexo, echo=FALSE, fig.align='center', warning=FALSE, fig.width=6, fig.height=5, message = FALSE  }
# Sexo
muestra_antivacunas_sexo <- 
  movid_2022 |> 
  filter(antivacunas == "Antivacunas") |> 
  group_by(sexo) |> 
  tally()|> 
  rename(Sexo = sexo) |> 
  mutate(Sexo = recode(as.factor(Sexo), '1' = "Hombre", '2' = "Mujer"))


muestra_antivacunas_sexo |> kable(booktabs = TRUE, caption = "Sexo de las personas que se encuentran contra las inmunizaciones en general") |> kable_styling(latex_options = "hold_position", full_width = F, position = "center")

```

```{r muestra_antivacunas_edad, echo=FALSE, fig.align='center', warning=FALSE, fig.width=6, fig.height=5, message = FALSE  }


# Tramo etario
muestra_antivacunas_edad <- 
  movid_2022 |> 
  filter(antivacunas == "Antivacunas") |> 
  group_by(edad_2) |> 
  tally()|> 
  rename(`Tramo etario` = edad_2) 

muestra_antivacunas_edad |> kable(booktabs = TRUE, caption = "Tramo etario de las personas que se encuentran contra las inmunizaciones en general") |> kable_styling(latex_options = "hold_position", full_width = F, position = "center")

```

```{r muestra_antivacunas_medios, echo=FALSE, fig.align='center', warning=FALSE, fig.width=6, fig.height=5, message = FALSE  }

# Medios de información 
muestra_antivacunas_medios <- 
  movid_2022 |> 
  filter(antivacunas == "Antivacunas") |> 
  group_by(mi_web_o_tradicionales) |> 
  tally()|> 
  rename(`Principal medio de información` = mi_web_o_tradicionales) 

muestra_antivacunas_medios |> kable(booktabs = TRUE, caption = "Principal medio de información de las personas que se encuentran contra las inmunizaciones en general") |> kable_styling(latex_options = "hold_position", full_width = F, position = "center")


```



```{r muestra_antivacunas_medicina_alternativa, echo=FALSE, fig.align='center', warning=FALSE, fig.width=6, fig.height=5, message = FALSE  }

# e1_1 Medicina alternativa
muestra_antivacunas_medicina_alternativa <- 
movid_2022 |> 
  filter(antivacunas == "Antivacunas") |> 
  group_by(e1_1_recoded) |> 
  tally() |> 
  rename(`La medicina alternativa puede ser más efectiva que la convencional para enfrentar la pandemia` = e1_1_recoded) 

muestra_antivacunas_medicina_alternativa |> kable(booktabs = TRUE, caption = "Creencia en la medicina alternativa de las personas que se encuentran contra las inmunizaciones en general") |> kable_styling(latex_options = "hold_position", full_width = F, position = "center")


```


```{r muestra_antivacunas_conspiracionismo, echo=FALSE, fig.align='center', warning=FALSE, fig.width=6, fig.height=5, message = FALSE  }

# e1_2 Conspiracionismo
muestra_antivacunas_conspiracionismo <- 
movid_2022 |> 
  filter(antivacunas == "Antivacunas") |> 
  group_by(e1_2_recoded) |> 
  tally()|> 
  rename(`La pandemia COVID19 fue creada intencionalmente, con fines políticos y económicos` = e1_2_recoded) 

muestra_antivacunas_conspiracionismo |> kable(booktabs = TRUE, caption = "Visión de los origines del covid entre las personas que se encuentran contra las inmunizaciones en general") |> kable_styling(latex_options = "hold_position", full_width = F, position = "center")
```

\newpage

### 9. Prevalencia de sintomatología post COVID-19 (Long COVID) 

"Long COVID" o "COVID-19 prolongado" se refiere a una serie de síntomas que continúan durante semanas o incluso meses después de que la etapa aguda de la infección por SARS-CoV-2 (el virus que causa la COVID-19) ha resuelto. Es una condición que se ha reconocido cada vez más a medida que la pandemia de COVID-19 ha continuado.

Los síntomas de long COVID pueden variar ampliamente entre las personas y pueden incluir:

- Fatiga extrema (a veces denominada "neblina mental")
- Dificultad para respirar o sensación de falta de aliento
- Tos persistente
- Dolor en las articulaciones o los músculos
- Problemas de salud mental como ansiedad y depresión
- Problemas de concentración y memoria
- Pérdida del olfato y del gusto
- Dolor de pecho
- Palpitaciones cardíacas
- Problemas para dormir
- Erupciones cutáneas
- Otros sintomas

Para evaluar esta sintomatología  en la encuesta, se consultó a las personas que fueron diangosticadas por COVID-19 si tuvieron sintomas que duraron más de un mes (pregunta d9 en cuestionario 2020 y c6 c6 en cuestionario 2022).En el año 2020 un 21.6% (IC95% 9.54-33.6) de la población declaró tener sintomas por más de un mes, mientras que, en el año 2022 un 35.4% (IC95% 27.7-43.1) informó haber sufrido sintomas más allá del mes, por lo tanto, no es posible afirmar que existen diferencias entre ambos años con un 95% de confianza.  

No obstante, con los datos anteriores se puede observar que, al menos, entre 1/4 y 1/3 de las personas que sufrieron la enfermedad en el país experimentaron sintomas asociados al denominado Long COVID. 

```{r long_covid_comparacion_anos, echo=FALSE, fig.align='center', warning=FALSE, fig.width=6, fig.height=5, message = FALSE  }

# d9. Personas que tuvieron sintomas que duraron màs de un mes por covid 
long_covid_2020 <- 
  movid_2020_s |> 
  filter(d6 == 1, !d9 == 8, !d9 == 9) |> 
  group_by(d9) |> 
  summarize(proportion = survey_mean(vartype = "ci")) |> 
  mutate(ano = "2020") |> 
  select(ano, long_covid = d9, everything())
#c6
long_covid_2022 <-
  movid_2022_s |> 
  filter(c1 == 1, !c6 == 8, !c6 == 9) |> 
  group_by(c6) |> 
  summarize(proportion = survey_mean(vartype = "ci"))|> 
  mutate(ano = "2022") |> 
  select(ano, long_covid = c6, everything())

# Comparacion anos 2020 y2022

long_covid_comparacion_anos <- rbind(long_covid_2020, long_covid_2022)
long_covid_comparacion_anos <- 
  long_covid_comparacion_anos |> 
  mutate(long_covid = recode(as.factor(long_covid), 
                             '1' = "Sintomas por más de un mes", 
                             '2' = "Sin sintomas por más de un mes"))

graph_barras_bivariado(long_covid_comparacion_anos, 
                       titulo = "Prevalencia Long-COVID, comparación años",
                       subtitulo = "Personas con sintomas que duraron más de un mes tras COVID-19")
```

Al analizar con más profundidad los datos del año 2022 y desagregarlos por otras variables independientes (sexo, tramo etario y  enfermedad crónica) no fue posible encontrar diferencias significativas con un 95% de confianza dado que el tamaño de la muestra es muy pequeño, dando intervalos de confianza muy amplios para cada respuesta. 


```{r long_covid_2022_sexo, echo=FALSE, fig.align='center', warning=FALSE, fig.width=6, fig.height=5, message = FALSE  }
# Sexo
long_covid_2022_sexo <- 
movid_2022_s |> 
  filter(c1 == 1, !c6 == 8, !c6 == 9) |> 
  group_by(sexo, c6) |> 
  summarize(proportion = survey_mean(vartype = "ci")) |> 
  mutate(c6 = recode(as.factor(c6), 
                             '1' = "Sintomas por más de un mes", 
                             '2' = "Sin sintomas por más de un mes"),
         sexo = recode(as.factor(sexo), '1' = "Hombre", '2' = "Mujer"))
 
graph_barras_bivariado(long_covid_2022_sexo, 
                       titulo = "Prevalencia Long-COVID, año 2022",
                       subtitulo = "Personas con sintomas que duraron más de un mes tras COVID-19, según sexo")
```

Asimismo, se observan diferencias según el tramo etario 201

```{r long_covid_2022_edad, echo=FALSE, fig.align='center', warning=FALSE, fig.width=6, fig.height=5, message = FALSE  }
# Tramo etario
long_covid_2022_edad <- 
movid_2022_s |> 
  filter(c1 == 1, !c6 == 8, !c6 == 9) |> 
  group_by(edad_2, c6) |> 
  summarize(proportion = survey_mean(vartype = "ci")) |> 
  mutate(c6 = recode(as.factor(c6), 
                             '1' = "Sintomas por más de un mes", 
                             '2' = "Sin sintomas por más de un mes")) 
 
graph_barras_bivariado(long_covid_2022_edad, 
                       titulo = "Prevalencia Long-COVID, año 2022",
                       subtitulo = "Personas con sintomas que duraron más de un mes tras COVID-19, \n según tramo etario")
```

No hay diferencias concluyentes en prevalencia de long covid entre personas que sufren una enfermedad crónica respecto a quienes no. 

```{r long_covid_2022_cronicos, echo=FALSE, fig.align='center', warning=FALSE, fig.width=6, fig.height=5, message = FALSE  }
# Pacientes cronicos
long_covid_2022_cronicos <- 
movid_2022_s |> 
  filter(c1 == 1, !c6 == 8, !c6 == 9) |> 
  group_by(cronica_d, c6) |> 
  summarize(proportion = survey_mean(vartype = "ci"))|> 
  mutate(c6 = recode(as.factor(c6), 
                             '1' = "Sintomas por más de un mes", 
                             '2' = "Sin sintomas por más de un mes"),
         cronica_d = recode(as.factor(cronica_d), 
                             '1' = "Con enfermedad crónica", 
                             '0' = "Sin enfermedad crónica"))

graph_barras_bivariado(long_covid_2022_cronicos, 
                        titulo = "Prevalencia Long-COVID, año 2022",
                       subtitulo = "Personas con sintomas que duraron más de un mes tras COVID-19, \n según padecimiento enfermedad crónica")
```


### 10.Prevalencia de patologías de salud mental post pandemia por COVID-19

Por último, respecto a la prevalencia de patologías de salud mental post pandemia por COVID-19, no existen preguntas en la encuesta que evaluen este item en el año 2022, pero si existe a comienzos de la pandemia en la versón 2020 de la encuesta.  En dicha versión se aplicó a los participantes la metodología PHQ-4 que  es una herramienta de detección rápida para la depresión y la ansiedad con  la que se puede utilizar para construir un índice de salud mental rudimentario. 


El PHQ-4 consta de cuatro preguntas con cuatro opciones de respuesta: "Nada en absoluto", "Varios días", "Más de la mitad de los días", y "Casi todos los días", que se puntúan de 0 a 3 respectivamente.

Por lo tanto, el rango total de puntajes posibles para el PHQ-4 va de 0 (sin síntomas de ansiedad o depresión) a 12 (síntomas muy severos de ansiedad y depresión).

La interpretación generalmente aceptada de los puntajes del PHQ-4 es la siguiente:

- Un puntaje de 0 a 2 indica no hay síntomas de ansiedad ni depresión.
- Un puntaje de 3 a 5 indica posibles síntomas de ansiedad o depresión.
- Un puntaje de 6 a 8 indica síntomas moderados de ansiedad y/o depresión.
- Un puntaje de 9 a 12 indica síntomas severos de ansiedad y/o depresión.


Según los resultados de este indice, en junio de 2020 alrededor de la mitad de los mayores de 18 años podrían sufrir posibles síntomas de ansiedad o depresión o niveles más altos de ansiedad y depresión. 

```{r salud_mental_2020, echo=FALSE, fig.align='center', warning=FALSE, fig.width=6, fig.height=5, message = FALSE  }
# Pacientes cronicos
## Indice salud mental año 2020.
salud_mental_2020 <- 
  movid_2020_s |> 
  filter() |> 
  group_by(phq_4_categorico) |> 
  summarize(proportion = survey_mean(vartype = "ci"))

graph_barras_univariado(salud_mental_2020, 
                       titulo = "Prevalencia de sintomas de ansiedad y depresión, año 2020",
                       ancho_texto_x = 15)
```

No se observan mayores diferencias según edad o sexo. 

```{r salud_mental_2020_sexo, echo=FALSE, fig.align='center', warning=FALSE, fig.width=6, fig.height=5, message = FALSE  }
# Sexo
salud_mental_2020_sexo <- 
movid_2020_s |> 
  filter() |> 
  group_by(sexo, phq_4_categorico) |> 
  summarize(proportion = survey_mean(vartype = "ci")) |> 
  mutate(sexo = recode(as.factor(sexo), '1' = "Hombre", '2' = "Mujer")) |> 
  mutate(phq_4_categorico = str_wrap(phq_4_categorico, width = 15))

graph_barras_bivariado(
  salud_mental_2020_sexo,
  titulo = "Prevalencia de sintomas de ansiedad y depresión, año 2020",
  subtitulo = "Desagregado según sexo",
  ancho_texto_x = 15
)
```

```{r salud_mental_2020_edad, echo=FALSE, fig.align='center', warning=FALSE, fig.width=6, fig.height=5, message = FALSE  }
# Tramo etario
salud_mental_2020_edad <- 
movid_2020_s |> 
  filter() |> 
  group_by(edad_2, phq_4_categorico) |> 
  summarize(proportion = survey_mean(vartype = "ci"))|> 
  mutate(phq_4_categorico = str_wrap(phq_4_categorico, width = 15))

graph_barras_bivariado(salud_mental_2020_edad, 
                       titulo = "Prevalencia de sintomas de ansiedad y depresión, año 2020",
                       subtitulo = "Desagregado según tramo etario",
                       ancho_texto_x = 15)
```

En cuanto a la prevalencia de condiciones de salud mental diagnósticadas, no se observan diferencias entre el año 2020 y 2022. 

```{r depresion_diagnositacada_comparacion_anos, echo=FALSE, fig.align='center', warning=FALSE, fig.width=6, fig.height=5, message = FALSE  }

## Prevalencia condiciones de salud mental diagnosticadas, comparacion año 2020 y 2022

#Año 2020
diagnostico_salud_mental_2020 <- 
  movid_2020_s |> 
  filter() |> 
  group_by(c1_5) |> 
  summarize(   proportion = survey_mean(vartype = "ci")) |> 
  mutate(ano = "2020") |> 
  select(ano, valoracion = c1_5,  everything()) |> 
  mutate(valoracion = ifelse(valoracion == 0, "Sin condición de salud mental", "Con condición de salud mental diagnosticada"))
# Año 2022
diagnostico_salud_mental_2022 <- 
  movid_2022_s |> 
  filter() |> 
  group_by(b2_l) |> 
  summarize(proportion = survey_mean(vartype = "ci")) |> 
  mutate(ano = "2022") |> 
  select(ano, valoracion = b2_l,  everything()) |> 
  mutate(valoracion = ifelse(valoracion == 2, "Sin condición de salud mental", "Con condición de salud mental diagnosticada"))


# Tabulado con comparacion de los anos

diagnostico_salud_mental_comparacion_anos <- rbind(diagnostico_salud_mental_2020, diagnostico_salud_mental_2022)

graph_barras_bivariado(diagnostico_salud_mental_comparacion_anos, 
                        titulo = "Prevalencia condiciones de salud mental diagnosticada")
```